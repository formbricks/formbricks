{"version":3,"file":"index.umd.cjs","sources":["../src/lib/constants.ts","../src/lib/logger.ts","../src/lib/errors.ts","../src/lib/config.ts","../../api/dist/index.js","../../lib/utils/promises.ts","../../lib/responseQueue.ts","../../lib/surveyState.ts","../../lib/utils/styling.ts","../../lib/utils/datetime.ts","../src/lib/utils.ts","../src/lib/widget.ts","../src/lib/actions.ts","../src/lib/personState.ts","../src/lib/attributes.ts","../../types/error-handlers.ts","../src/lib/environmentState.ts","../src/lib/noCodeActions.ts","../src/lib/eventListeners.ts","../src/lib/initialize.ts","../src/lib/person.ts","../src/index.ts","../src/lib/commandQueue.ts","../src/lib/api.ts"],"sourcesContent":["export const RN_ASYNC_STORAGE_KEY = \"formbricks-react-native\";\nexport const JS_LOCAL_STORAGE_KEY = \"formbricks-js\";\nexport const LEGACY_JS_WEBSITE_LOCAL_STORAGE_KEY = \"formbricks-js-website\";\nexport const LEGACY_JS_APP_LOCAL_STORAGE_KEY = \"formbricks-js-app\";\nexport const CONTAINER_ID = \"formbricks-app-container\";\n","type LogLevel = \"debug\" | \"error\";\n\ninterface LoggerConfig {\n  logLevel?: LogLevel;\n}\n\nexport class Logger {\n  private static instance: Logger | undefined;\n  private logLevel: LogLevel = \"error\";\n\n  private constructor() {}\n\n  static getInstance(): Logger {\n    if (!Logger.instance) {\n      Logger.instance = new Logger();\n    }\n    return Logger.instance;\n  }\n\n  configure(config: LoggerConfig): void {\n    if (config && config.logLevel !== undefined) {\n      this.logLevel = config.logLevel;\n    }\n  }\n\n  private logger(message: string, level: LogLevel): void {\n    if (level === \"debug\" && this.logLevel !== \"debug\") {\n      return;\n    }\n\n    const timestamp = new Date().toISOString();\n    const logMessage = `ðŸ§± Formbricks - ${timestamp} [${level.toUpperCase()}] - ${message}`;\n    if (level === \"error\") {\n      console.error(logMessage);\n    } else {\n      console.log(logMessage);\n    }\n  }\n\n  debug(message: string): void {\n    this.logger(message, \"debug\");\n  }\n\n  error(message: string): void {\n    this.logger(message, \"error\");\n  }\n}\n","import { Logger } from \"./logger\";\n\nexport type { ZErrorHandler } from \"@formbricks/types/errors\";\n\nexport type ResultError<T> = { ok: false; error: T };\n\nexport type ResultOk<T> = { ok: true; value: T };\n\nexport type Result<T, E = Error> = ResultOk<T> | ResultError<E>;\n\nexport const ok = <T, E>(value: T): Result<T, E> => ({ ok: true, value });\n\nexport const okVoid = <E>(): Result<void, E> => ({ ok: true, value: undefined });\n\nexport const err = <E = Error>(error: E): ResultError<E> => ({\n  ok: false,\n  error,\n});\n\nexport const wrap =\n  <T, R>(fn: (value: T) => R) =>\n  (result: Result<T>): Result<R> =>\n    result.ok === true ? { ok: true, value: fn(result.value) } : result;\n\nexport function match<TSuccess, TError, TReturn>(\n  result: Result<TSuccess, TError>,\n  onSuccess: (value: TSuccess) => TReturn,\n  onError: (error: TError) => TReturn\n) {\n  if (result.ok === true) {\n    return onSuccess(result.value);\n  }\n\n  return onError(result.error);\n}\n\n/* \nUsage: \nconst test = () => {\n  throw new Error(\"test\");\n};\n  \nconst result = wrapThrows(test)();\nif (result.ok === true) {\n  console.log(result.value);\n} else {\n  console.log(result.error);\n}\n*/\nexport const wrapThrows =\n  <T, A extends any[]>(fn: (...args: A) => T) =>\n  (...args: A): Result<T> => {\n    try {\n      return {\n        ok: true,\n        value: fn(...args),\n      };\n    } catch (error) {\n      return {\n        ok: false,\n        error: error as Error,\n      };\n    }\n  };\n\nexport type NetworkError = {\n  code: \"network_error\";\n  status: number;\n  message: string;\n  url: string;\n  responseMessage: string;\n};\n\nexport type MissingFieldError = {\n  code: \"missing_field\";\n  field: string;\n};\n\nexport type InvalidMatchTypeError = {\n  code: \"invalid_match_type\";\n  message: string;\n};\n\nexport type MissingPersonError = {\n  code: \"missing_person\";\n  message: string;\n};\n\nexport type NotInitializedError = {\n  code: \"not_initialized\";\n  message: string;\n};\n\nexport type AttributeAlreadyExistsError = {\n  code: \"attribute_already_exists\";\n  message: string;\n};\n\nexport type InvalidCodeError = {\n  code: \"invalid_code\";\n  message: string;\n};\n\nconst logger = Logger.getInstance();\n\nexport class ErrorHandler {\n  private static instance: ErrorHandler | null;\n  private handleError: (error: any) => void;\n  public customized: boolean = false;\n  public static initialized = false;\n\n  private constructor(errorHandler?: (error: any) => void) {\n    if (errorHandler) {\n      this.handleError = errorHandler;\n      this.customized = true;\n    } else {\n      this.handleError = (err) => Logger.getInstance().error(JSON.stringify(err));\n    }\n  }\n\n  static getInstance(): ErrorHandler {\n    if (!ErrorHandler.instance) {\n      ErrorHandler.instance = new ErrorHandler();\n    }\n\n    return ErrorHandler.instance;\n  }\n\n  static init(errorHandler?: (error: any) => void): void {\n    this.initialized = true;\n\n    ErrorHandler.instance = new ErrorHandler(errorHandler);\n  }\n\n  public printStatus(): void {\n    logger.debug(`Custom error handler: ${this.customized ? \"yes\" : \"no\"}`);\n  }\n\n  public handle(error: any): void {\n    console.warn(\"ðŸ§± Formbricks - Global error: \", error);\n    this.handleError(error);\n  }\n}\n","import { TJsConfig, TJsConfigUpdateInput } from \"@formbricks/types/js\";\nimport { JS_LOCAL_STORAGE_KEY } from \"./constants\";\nimport { Result, err, ok, wrapThrows } from \"./errors\";\n\nexport class Config {\n  private static instance: Config | undefined;\n  private config: TJsConfig | null = null;\n\n  private constructor() {\n    const savedConfig = this.loadFromLocalStorage();\n\n    if (savedConfig.ok) {\n      this.config = savedConfig.value;\n    }\n  }\n\n  static getInstance(): Config {\n    if (!Config.instance) {\n      Config.instance = new Config();\n    }\n    return Config.instance;\n  }\n\n  public update(newConfig: TJsConfigUpdateInput): void {\n    if (newConfig) {\n      this.config = {\n        ...this.config,\n        ...newConfig,\n        status: {\n          value: newConfig.status?.value || \"success\",\n          expiresAt: newConfig.status?.expiresAt || null,\n        },\n      };\n\n      this.saveToStorage();\n    }\n  }\n\n  public get(): TJsConfig {\n    if (!this.config) {\n      throw new Error(\"config is null, maybe the init function was not called?\");\n    }\n    return this.config;\n  }\n\n  public loadFromLocalStorage(): Result<TJsConfig, Error> {\n    if (typeof window !== \"undefined\") {\n      const savedConfig = localStorage.getItem(JS_LOCAL_STORAGE_KEY);\n      if (savedConfig) {\n        // TODO: validate config\n        // This is a hack to get around the fact that we don't have a proper\n        // way to validate the config yet.\n        const parsedConfig = JSON.parse(savedConfig) as TJsConfig;\n\n        // check if the config has expired\n        if (\n          parsedConfig.environmentState?.expiresAt &&\n          new Date(parsedConfig.environmentState.expiresAt) <= new Date()\n        ) {\n          return err(new Error(\"Config in local storage has expired\"));\n        }\n\n        return ok(parsedConfig);\n      }\n    }\n\n    return err(new Error(\"No or invalid config in local storage\"));\n  }\n\n  private async saveToStorage(): Promise<Result<Promise<void>, Error>> {\n    return wrapThrows(async () => {\n      await localStorage.setItem(JS_LOCAL_STORAGE_KEY, JSON.stringify(this.config));\n    })();\n  }\n\n  // reset the config\n\n  public async resetConfig(): Promise<Result<Promise<void>, Error>> {\n    this.config = null;\n\n    return wrapThrows(async () => {\n      localStorage.removeItem(JS_LOCAL_STORAGE_KEY);\n    })();\n  }\n}\n","var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\nconst ok = (data) => ({ ok: true, data });\nconst err = (error) => ({\n  ok: false,\n  error\n});\nconst wrapThrowsAsync = (fn) => async (...args) => {\n  try {\n    return {\n      ok: true,\n      data: await fn(...args)\n    };\n  } catch (error) {\n    return {\n      ok: false,\n      error\n    };\n  }\n};\nconst makeRequest = async (apiHost, endpoint, method, data) => {\n  const url = new URL(apiHost + endpoint);\n  const body = data ? JSON.stringify(data) : void 0;\n  const res = await wrapThrowsAsync(fetch)(url.toString(), {\n    method,\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body\n  });\n  if (!res.ok) return err(res.error);\n  const response = res.data;\n  const json = await response.json();\n  if (!response.ok) {\n    const errorResponse = json;\n    return err({\n      code: \"network_error\",\n      status: response.status,\n      message: errorResponse.message || \"Something went wrong\",\n      url,\n      ...Object.keys(errorResponse.details).length > 0 && { details: errorResponse.details }\n    });\n  }\n  const successResponse = json;\n  return ok(successResponse.data);\n};\nclass AttributeAPI {\n  constructor(apiHost, environmentId) {\n    __publicField(this, \"apiHost\");\n    __publicField(this, \"environmentId\");\n    this.apiHost = apiHost;\n    this.environmentId = environmentId;\n  }\n  async update(attributeUpdateInput) {\n    const attributes = {};\n    for (const key in attributeUpdateInput.attributes) {\n      attributes[key] = String(attributeUpdateInput.attributes[key]);\n    }\n    return makeRequest(\n      this.apiHost,\n      `/api/v1/client/${this.environmentId}/people/${attributeUpdateInput.userId}/attributes`,\n      \"PUT\",\n      { attributes }\n    );\n  }\n}\nclass DisplayAPI {\n  constructor(baseUrl, environmentId) {\n    __publicField(this, \"apiHost\");\n    __publicField(this, \"environmentId\");\n    this.apiHost = baseUrl;\n    this.environmentId = environmentId;\n  }\n  async create(displayInput) {\n    return makeRequest(this.apiHost, `/api/v1/client/${this.environmentId}/displays`, \"POST\", displayInput);\n  }\n}\nclass PeopleAPI {\n  constructor(apiHost, environmentId) {\n    __publicField(this, \"apiHost\");\n    __publicField(this, \"environmentId\");\n    this.apiHost = apiHost;\n    this.environmentId = environmentId;\n  }\n  async create(userId) {\n    return makeRequest(this.apiHost, `/api/v1/client/${this.environmentId}/people`, \"POST\", {\n      environmentId: this.environmentId,\n      userId\n    });\n  }\n}\nclass ResponseAPI {\n  constructor(apiHost, environmentId) {\n    __publicField(this, \"apiHost\");\n    __publicField(this, \"environmentId\");\n    this.apiHost = apiHost;\n    this.environmentId = environmentId;\n  }\n  async create(responseInput) {\n    return makeRequest(this.apiHost, `/api/v1/client/${this.environmentId}/responses`, \"POST\", responseInput);\n  }\n  async update({\n    responseId,\n    finished,\n    data,\n    ttc,\n    variables,\n    language\n  }) {\n    return makeRequest(this.apiHost, `/api/v1/client/${this.environmentId}/responses/${responseId}`, \"PUT\", {\n      finished,\n      data,\n      ttc,\n      variables,\n      language\n    });\n  }\n}\nvar buffer = {};\nvar base64Js = {};\nbase64Js.byteLength = byteLength;\nbase64Js.toByteArray = toByteArray;\nbase64Js.fromByteArray = fromByteArray;\nvar lookup = [];\nvar revLookup = [];\nvar Arr = typeof Uint8Array !== \"undefined\" ? Uint8Array : Array;\nvar code = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i];\n  revLookup[code.charCodeAt(i)] = i;\n}\nrevLookup[\"-\".charCodeAt(0)] = 62;\nrevLookup[\"_\".charCodeAt(0)] = 63;\nfunction getLens(b64) {\n  var len = b64.length;\n  if (len % 4 > 0) {\n    throw new Error(\"Invalid string. Length must be a multiple of 4\");\n  }\n  var validLen = b64.indexOf(\"=\");\n  if (validLen === -1) validLen = len;\n  var placeHoldersLen = validLen === len ? 0 : 4 - validLen % 4;\n  return [validLen, placeHoldersLen];\n}\nfunction byteLength(b64) {\n  var lens = getLens(b64);\n  var validLen = lens[0];\n  var placeHoldersLen = lens[1];\n  return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;\n}\nfunction _byteLength(b64, validLen, placeHoldersLen) {\n  return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;\n}\nfunction toByteArray(b64) {\n  var tmp;\n  var lens = getLens(b64);\n  var validLen = lens[0];\n  var placeHoldersLen = lens[1];\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen));\n  var curByte = 0;\n  var len = placeHoldersLen > 0 ? validLen - 4 : validLen;\n  var i;\n  for (i = 0; i < len; i += 4) {\n    tmp = revLookup[b64.charCodeAt(i)] << 18 | revLookup[b64.charCodeAt(i + 1)] << 12 | revLookup[b64.charCodeAt(i + 2)] << 6 | revLookup[b64.charCodeAt(i + 3)];\n    arr[curByte++] = tmp >> 16 & 255;\n    arr[curByte++] = tmp >> 8 & 255;\n    arr[curByte++] = tmp & 255;\n  }\n  if (placeHoldersLen === 2) {\n    tmp = revLookup[b64.charCodeAt(i)] << 2 | revLookup[b64.charCodeAt(i + 1)] >> 4;\n    arr[curByte++] = tmp & 255;\n  }\n  if (placeHoldersLen === 1) {\n    tmp = revLookup[b64.charCodeAt(i)] << 10 | revLookup[b64.charCodeAt(i + 1)] << 4 | revLookup[b64.charCodeAt(i + 2)] >> 2;\n    arr[curByte++] = tmp >> 8 & 255;\n    arr[curByte++] = tmp & 255;\n  }\n  return arr;\n}\nfunction tripletToBase64(num) {\n  return lookup[num >> 18 & 63] + lookup[num >> 12 & 63] + lookup[num >> 6 & 63] + lookup[num & 63];\n}\nfunction encodeChunk(uint8, start, end) {\n  var tmp;\n  var output = [];\n  for (var i = start; i < end; i += 3) {\n    tmp = (uint8[i] << 16 & 16711680) + (uint8[i + 1] << 8 & 65280) + (uint8[i + 2] & 255);\n    output.push(tripletToBase64(tmp));\n  }\n  return output.join(\"\");\n}\nfunction fromByteArray(uint8) {\n  var tmp;\n  var len = uint8.length;\n  var extraBytes = len % 3;\n  var parts = [];\n  var maxChunkLength = 16383;\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, i + maxChunkLength > len2 ? len2 : i + maxChunkLength));\n  }\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1];\n    parts.push(\n      lookup[tmp >> 2] + lookup[tmp << 4 & 63] + \"==\"\n    );\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1];\n    parts.push(\n      lookup[tmp >> 10] + lookup[tmp >> 4 & 63] + lookup[tmp << 2 & 63] + \"=\"\n    );\n  }\n  return parts.join(\"\");\n}\nvar ieee754 = {};\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nieee754.read = function(buffer2, offset, isLE, mLen, nBytes) {\n  var e, m;\n  var eLen = nBytes * 8 - mLen - 1;\n  var eMax = (1 << eLen) - 1;\n  var eBias = eMax >> 1;\n  var nBits = -7;\n  var i = isLE ? nBytes - 1 : 0;\n  var d = isLE ? -1 : 1;\n  var s = buffer2[offset + i];\n  i += d;\n  e = s & (1 << -nBits) - 1;\n  s >>= -nBits;\n  nBits += eLen;\n  for (; nBits > 0; e = e * 256 + buffer2[offset + i], i += d, nBits -= 8) {\n  }\n  m = e & (1 << -nBits) - 1;\n  e >>= -nBits;\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer2[offset + i], i += d, nBits -= 8) {\n  }\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : (s ? -1 : 1) * Infinity;\n  } else {\n    m = m + Math.pow(2, mLen);\n    e = e - eBias;\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);\n};\nieee754.write = function(buffer2, value, offset, isLE, mLen, nBytes) {\n  var e, m, c;\n  var eLen = nBytes * 8 - mLen - 1;\n  var eMax = (1 << eLen) - 1;\n  var eBias = eMax >> 1;\n  var rt = mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0;\n  var i = isLE ? 0 : nBytes - 1;\n  var d = isLE ? 1 : -1;\n  var s = value < 0 || value === 0 && 1 / value < 0 ? 1 : 0;\n  value = Math.abs(value);\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0;\n    e = eMax;\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2);\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * Math.pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);\n      e = 0;\n    }\n  }\n  for (; mLen >= 8; buffer2[offset + i] = m & 255, i += d, m /= 256, mLen -= 8) {\n  }\n  e = e << mLen | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer2[offset + i] = e & 255, i += d, e /= 256, eLen -= 8) {\n  }\n  buffer2[offset + i - d] |= s * 128;\n};\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n(function(exports) {\n  const base64 = base64Js;\n  const ieee754$1 = ieee754;\n  const customInspectSymbol = typeof Symbol === \"function\" && typeof Symbol[\"for\"] === \"function\" ? Symbol[\"for\"](\"nodejs.util.inspect.custom\") : null;\n  exports.Buffer = Buffer2;\n  exports.SlowBuffer = SlowBuffer;\n  exports.INSPECT_MAX_BYTES = 50;\n  const K_MAX_LENGTH = 2147483647;\n  exports.kMaxLength = K_MAX_LENGTH;\n  const { Uint8Array: GlobalUint8Array, ArrayBuffer: GlobalArrayBuffer, SharedArrayBuffer: GlobalSharedArrayBuffer } = globalThis;\n  Buffer2.TYPED_ARRAY_SUPPORT = typedArraySupport();\n  if (!Buffer2.TYPED_ARRAY_SUPPORT && typeof console !== \"undefined\" && typeof console.error === \"function\") {\n    console.error(\n      \"This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.\"\n    );\n  }\n  function typedArraySupport() {\n    try {\n      const arr = new GlobalUint8Array(1);\n      const proto = { foo: function() {\n        return 42;\n      } };\n      Object.setPrototypeOf(proto, GlobalUint8Array.prototype);\n      Object.setPrototypeOf(arr, proto);\n      return arr.foo() === 42;\n    } catch (e) {\n      return false;\n    }\n  }\n  Object.defineProperty(Buffer2.prototype, \"parent\", {\n    enumerable: true,\n    get: function() {\n      if (!Buffer2.isBuffer(this)) return void 0;\n      return this.buffer;\n    }\n  });\n  Object.defineProperty(Buffer2.prototype, \"offset\", {\n    enumerable: true,\n    get: function() {\n      if (!Buffer2.isBuffer(this)) return void 0;\n      return this.byteOffset;\n    }\n  });\n  function createBuffer(length) {\n    if (length > K_MAX_LENGTH) {\n      throw new RangeError('The value \"' + length + '\" is invalid for option \"size\"');\n    }\n    const buf = new GlobalUint8Array(length);\n    Object.setPrototypeOf(buf, Buffer2.prototype);\n    return buf;\n  }\n  function Buffer2(arg, encodingOrOffset, length) {\n    if (typeof arg === \"number\") {\n      if (typeof encodingOrOffset === \"string\") {\n        throw new TypeError(\n          'The \"string\" argument must be of type string. Received type number'\n        );\n      }\n      return allocUnsafe(arg);\n    }\n    return from(arg, encodingOrOffset, length);\n  }\n  Buffer2.poolSize = 8192;\n  function from(value, encodingOrOffset, length) {\n    if (typeof value === \"string\") {\n      return fromString(value, encodingOrOffset);\n    }\n    if (GlobalArrayBuffer.isView(value)) {\n      return fromArrayView(value);\n    }\n    if (value == null) {\n      throw new TypeError(\n        \"The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type \" + typeof value\n      );\n    }\n    if (isInstance(value, GlobalArrayBuffer) || value && isInstance(value.buffer, GlobalArrayBuffer)) {\n      return fromArrayBuffer(value, encodingOrOffset, length);\n    }\n    if (typeof GlobalSharedArrayBuffer !== \"undefined\" && (isInstance(value, GlobalSharedArrayBuffer) || value && isInstance(value.buffer, GlobalSharedArrayBuffer))) {\n      return fromArrayBuffer(value, encodingOrOffset, length);\n    }\n    if (typeof value === \"number\") {\n      throw new TypeError(\n        'The \"value\" argument must not be of type number. Received type number'\n      );\n    }\n    const valueOf = value.valueOf && value.valueOf();\n    if (valueOf != null && valueOf !== value) {\n      return Buffer2.from(valueOf, encodingOrOffset, length);\n    }\n    const b = fromObject(value);\n    if (b) return b;\n    if (typeof Symbol !== \"undefined\" && Symbol.toPrimitive != null && typeof value[Symbol.toPrimitive] === \"function\") {\n      return Buffer2.from(value[Symbol.toPrimitive](\"string\"), encodingOrOffset, length);\n    }\n    throw new TypeError(\n      \"The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type \" + typeof value\n    );\n  }\n  Buffer2.from = function(value, encodingOrOffset, length) {\n    return from(value, encodingOrOffset, length);\n  };\n  Object.setPrototypeOf(Buffer2.prototype, GlobalUint8Array.prototype);\n  Object.setPrototypeOf(Buffer2, GlobalUint8Array);\n  function assertSize(size) {\n    if (typeof size !== \"number\") {\n      throw new TypeError('\"size\" argument must be of type number');\n    } else if (size < 0) {\n      throw new RangeError('The value \"' + size + '\" is invalid for option \"size\"');\n    }\n  }\n  function alloc(size, fill, encoding) {\n    assertSize(size);\n    if (size <= 0) {\n      return createBuffer(size);\n    }\n    if (fill !== void 0) {\n      return typeof encoding === \"string\" ? createBuffer(size).fill(fill, encoding) : createBuffer(size).fill(fill);\n    }\n    return createBuffer(size);\n  }\n  Buffer2.alloc = function(size, fill, encoding) {\n    return alloc(size, fill, encoding);\n  };\n  function allocUnsafe(size) {\n    assertSize(size);\n    return createBuffer(size < 0 ? 0 : checked(size) | 0);\n  }\n  Buffer2.allocUnsafe = function(size) {\n    return allocUnsafe(size);\n  };\n  Buffer2.allocUnsafeSlow = function(size) {\n    return allocUnsafe(size);\n  };\n  function fromString(string, encoding) {\n    if (typeof encoding !== \"string\" || encoding === \"\") {\n      encoding = \"utf8\";\n    }\n    if (!Buffer2.isEncoding(encoding)) {\n      throw new TypeError(\"Unknown encoding: \" + encoding);\n    }\n    const length = byteLength2(string, encoding) | 0;\n    let buf = createBuffer(length);\n    const actual = buf.write(string, encoding);\n    if (actual !== length) {\n      buf = buf.slice(0, actual);\n    }\n    return buf;\n  }\n  function fromArrayLike(array) {\n    const length = array.length < 0 ? 0 : checked(array.length) | 0;\n    const buf = createBuffer(length);\n    for (let i = 0; i < length; i += 1) {\n      buf[i] = array[i] & 255;\n    }\n    return buf;\n  }\n  function fromArrayView(arrayView) {\n    if (isInstance(arrayView, GlobalUint8Array)) {\n      const copy = new GlobalUint8Array(arrayView);\n      return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength);\n    }\n    return fromArrayLike(arrayView);\n  }\n  function fromArrayBuffer(array, byteOffset, length) {\n    if (byteOffset < 0 || array.byteLength < byteOffset) {\n      throw new RangeError('\"offset\" is outside of buffer bounds');\n    }\n    if (array.byteLength < byteOffset + (length || 0)) {\n      throw new RangeError('\"length\" is outside of buffer bounds');\n    }\n    let buf;\n    if (byteOffset === void 0 && length === void 0) {\n      buf = new GlobalUint8Array(array);\n    } else if (length === void 0) {\n      buf = new GlobalUint8Array(array, byteOffset);\n    } else {\n      buf = new GlobalUint8Array(array, byteOffset, length);\n    }\n    Object.setPrototypeOf(buf, Buffer2.prototype);\n    return buf;\n  }\n  function fromObject(obj) {\n    if (Buffer2.isBuffer(obj)) {\n      const len = checked(obj.length) | 0;\n      const buf = createBuffer(len);\n      if (buf.length === 0) {\n        return buf;\n      }\n      obj.copy(buf, 0, 0, len);\n      return buf;\n    }\n    if (obj.length !== void 0) {\n      if (typeof obj.length !== \"number\" || numberIsNaN(obj.length)) {\n        return createBuffer(0);\n      }\n      return fromArrayLike(obj);\n    }\n    if (obj.type === \"Buffer\" && Array.isArray(obj.data)) {\n      return fromArrayLike(obj.data);\n    }\n  }\n  function checked(length) {\n    if (length >= K_MAX_LENGTH) {\n      throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\" + K_MAX_LENGTH.toString(16) + \" bytes\");\n    }\n    return length | 0;\n  }\n  function SlowBuffer(length) {\n    if (+length != length) {\n      length = 0;\n    }\n    return Buffer2.alloc(+length);\n  }\n  Buffer2.isBuffer = function isBuffer(b) {\n    return b != null && b._isBuffer === true && b !== Buffer2.prototype;\n  };\n  Buffer2.compare = function compare(a, b) {\n    if (isInstance(a, GlobalUint8Array)) a = Buffer2.from(a, a.offset, a.byteLength);\n    if (isInstance(b, GlobalUint8Array)) b = Buffer2.from(b, b.offset, b.byteLength);\n    if (!Buffer2.isBuffer(a) || !Buffer2.isBuffer(b)) {\n      throw new TypeError(\n        'The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array'\n      );\n    }\n    if (a === b) return 0;\n    let x = a.length;\n    let y = b.length;\n    for (let i = 0, len = Math.min(x, y); i < len; ++i) {\n      if (a[i] !== b[i]) {\n        x = a[i];\n        y = b[i];\n        break;\n      }\n    }\n    if (x < y) return -1;\n    if (y < x) return 1;\n    return 0;\n  };\n  Buffer2.isEncoding = function isEncoding(encoding) {\n    switch (String(encoding).toLowerCase()) {\n      case \"hex\":\n      case \"utf8\":\n      case \"utf-8\":\n      case \"ascii\":\n      case \"latin1\":\n      case \"binary\":\n      case \"base64\":\n      case \"ucs2\":\n      case \"ucs-2\":\n      case \"utf16le\":\n      case \"utf-16le\":\n        return true;\n      default:\n        return false;\n    }\n  };\n  Buffer2.concat = function concat(list, length) {\n    if (!Array.isArray(list)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers');\n    }\n    if (list.length === 0) {\n      return Buffer2.alloc(0);\n    }\n    let i;\n    if (length === void 0) {\n      length = 0;\n      for (i = 0; i < list.length; ++i) {\n        length += list[i].length;\n      }\n    }\n    const buffer2 = Buffer2.allocUnsafe(length);\n    let pos = 0;\n    for (i = 0; i < list.length; ++i) {\n      let buf = list[i];\n      if (isInstance(buf, GlobalUint8Array)) {\n        if (pos + buf.length > buffer2.length) {\n          if (!Buffer2.isBuffer(buf)) buf = Buffer2.from(buf);\n          buf.copy(buffer2, pos);\n        } else {\n          GlobalUint8Array.prototype.set.call(\n            buffer2,\n            buf,\n            pos\n          );\n        }\n      } else if (!Buffer2.isBuffer(buf)) {\n        throw new TypeError('\"list\" argument must be an Array of Buffers');\n      } else {\n        buf.copy(buffer2, pos);\n      }\n      pos += buf.length;\n    }\n    return buffer2;\n  };\n  function byteLength2(string, encoding) {\n    if (Buffer2.isBuffer(string)) {\n      return string.length;\n    }\n    if (GlobalArrayBuffer.isView(string) || isInstance(string, GlobalArrayBuffer)) {\n      return string.byteLength;\n    }\n    if (typeof string !== \"string\") {\n      throw new TypeError(\n        'The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. Received type ' + typeof string\n      );\n    }\n    const len = string.length;\n    const mustMatch = arguments.length > 2 && arguments[2] === true;\n    if (!mustMatch && len === 0) return 0;\n    let loweredCase = false;\n    for (; ; ) {\n      switch (encoding) {\n        case \"ascii\":\n        case \"latin1\":\n        case \"binary\":\n          return len;\n        case \"utf8\":\n        case \"utf-8\":\n          return utf8ToBytes(string).length;\n        case \"ucs2\":\n        case \"ucs-2\":\n        case \"utf16le\":\n        case \"utf-16le\":\n          return len * 2;\n        case \"hex\":\n          return len >>> 1;\n        case \"base64\":\n          return base64ToBytes(string).length;\n        default:\n          if (loweredCase) {\n            return mustMatch ? -1 : utf8ToBytes(string).length;\n          }\n          encoding = (\"\" + encoding).toLowerCase();\n          loweredCase = true;\n      }\n    }\n  }\n  Buffer2.byteLength = byteLength2;\n  function slowToString(encoding, start, end) {\n    let loweredCase = false;\n    if (start === void 0 || start < 0) {\n      start = 0;\n    }\n    if (start > this.length) {\n      return \"\";\n    }\n    if (end === void 0 || end > this.length) {\n      end = this.length;\n    }\n    if (end <= 0) {\n      return \"\";\n    }\n    end >>>= 0;\n    start >>>= 0;\n    if (end <= start) {\n      return \"\";\n    }\n    if (!encoding) encoding = \"utf8\";\n    while (true) {\n      switch (encoding) {\n        case \"hex\":\n          return hexSlice(this, start, end);\n        case \"utf8\":\n        case \"utf-8\":\n          return utf8Slice(this, start, end);\n        case \"ascii\":\n          return asciiSlice(this, start, end);\n        case \"latin1\":\n        case \"binary\":\n          return latin1Slice(this, start, end);\n        case \"base64\":\n          return base64Slice(this, start, end);\n        case \"ucs2\":\n        case \"ucs-2\":\n        case \"utf16le\":\n        case \"utf-16le\":\n          return utf16leSlice(this, start, end);\n        default:\n          if (loweredCase) throw new TypeError(\"Unknown encoding: \" + encoding);\n          encoding = (encoding + \"\").toLowerCase();\n          loweredCase = true;\n      }\n    }\n  }\n  Buffer2.prototype._isBuffer = true;\n  function swap(b, n, m) {\n    const i = b[n];\n    b[n] = b[m];\n    b[m] = i;\n  }\n  Buffer2.prototype.swap16 = function swap16() {\n    const len = this.length;\n    if (len % 2 !== 0) {\n      throw new RangeError(\"Buffer size must be a multiple of 16-bits\");\n    }\n    for (let i = 0; i < len; i += 2) {\n      swap(this, i, i + 1);\n    }\n    return this;\n  };\n  Buffer2.prototype.swap32 = function swap32() {\n    const len = this.length;\n    if (len % 4 !== 0) {\n      throw new RangeError(\"Buffer size must be a multiple of 32-bits\");\n    }\n    for (let i = 0; i < len; i += 4) {\n      swap(this, i, i + 3);\n      swap(this, i + 1, i + 2);\n    }\n    return this;\n  };\n  Buffer2.prototype.swap64 = function swap64() {\n    const len = this.length;\n    if (len % 8 !== 0) {\n      throw new RangeError(\"Buffer size must be a multiple of 64-bits\");\n    }\n    for (let i = 0; i < len; i += 8) {\n      swap(this, i, i + 7);\n      swap(this, i + 1, i + 6);\n      swap(this, i + 2, i + 5);\n      swap(this, i + 3, i + 4);\n    }\n    return this;\n  };\n  Buffer2.prototype.toString = function toString() {\n    const length = this.length;\n    if (length === 0) return \"\";\n    if (arguments.length === 0) return utf8Slice(this, 0, length);\n    return slowToString.apply(this, arguments);\n  };\n  Buffer2.prototype.toLocaleString = Buffer2.prototype.toString;\n  Buffer2.prototype.equals = function equals(b) {\n    if (!Buffer2.isBuffer(b)) throw new TypeError(\"Argument must be a Buffer\");\n    if (this === b) return true;\n    return Buffer2.compare(this, b) === 0;\n  };\n  Buffer2.prototype.inspect = function inspect() {\n    let str = \"\";\n    const max = exports.INSPECT_MAX_BYTES;\n    str = this.toString(\"hex\", 0, max).replace(/(.{2})/g, \"$1 \").trim();\n    if (this.length > max) str += \" ... \";\n    return \"<Buffer \" + str + \">\";\n  };\n  if (customInspectSymbol) {\n    Buffer2.prototype[customInspectSymbol] = Buffer2.prototype.inspect;\n  }\n  Buffer2.prototype.compare = function compare(target, start, end, thisStart, thisEnd) {\n    if (isInstance(target, GlobalUint8Array)) {\n      target = Buffer2.from(target, target.offset, target.byteLength);\n    }\n    if (!Buffer2.isBuffer(target)) {\n      throw new TypeError(\n        'The \"target\" argument must be one of type Buffer or Uint8Array. Received type ' + typeof target\n      );\n    }\n    if (start === void 0) {\n      start = 0;\n    }\n    if (end === void 0) {\n      end = target ? target.length : 0;\n    }\n    if (thisStart === void 0) {\n      thisStart = 0;\n    }\n    if (thisEnd === void 0) {\n      thisEnd = this.length;\n    }\n    if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n      throw new RangeError(\"out of range index\");\n    }\n    if (thisStart >= thisEnd && start >= end) {\n      return 0;\n    }\n    if (thisStart >= thisEnd) {\n      return -1;\n    }\n    if (start >= end) {\n      return 1;\n    }\n    start >>>= 0;\n    end >>>= 0;\n    thisStart >>>= 0;\n    thisEnd >>>= 0;\n    if (this === target) return 0;\n    let x = thisEnd - thisStart;\n    let y = end - start;\n    const len = Math.min(x, y);\n    const thisCopy = this.slice(thisStart, thisEnd);\n    const targetCopy = target.slice(start, end);\n    for (let i = 0; i < len; ++i) {\n      if (thisCopy[i] !== targetCopy[i]) {\n        x = thisCopy[i];\n        y = targetCopy[i];\n        break;\n      }\n    }\n    if (x < y) return -1;\n    if (y < x) return 1;\n    return 0;\n  };\n  function bidirectionalIndexOf(buffer2, val, byteOffset, encoding, dir) {\n    if (buffer2.length === 0) return -1;\n    if (typeof byteOffset === \"string\") {\n      encoding = byteOffset;\n      byteOffset = 0;\n    } else if (byteOffset > 2147483647) {\n      byteOffset = 2147483647;\n    } else if (byteOffset < -2147483648) {\n      byteOffset = -2147483648;\n    }\n    byteOffset = +byteOffset;\n    if (numberIsNaN(byteOffset)) {\n      byteOffset = dir ? 0 : buffer2.length - 1;\n    }\n    if (byteOffset < 0) byteOffset = buffer2.length + byteOffset;\n    if (byteOffset >= buffer2.length) {\n      if (dir) return -1;\n      else byteOffset = buffer2.length - 1;\n    } else if (byteOffset < 0) {\n      if (dir) byteOffset = 0;\n      else return -1;\n    }\n    if (typeof val === \"string\") {\n      val = Buffer2.from(val, encoding);\n    }\n    if (Buffer2.isBuffer(val)) {\n      if (val.length === 0) {\n        return -1;\n      }\n      return arrayIndexOf(buffer2, val, byteOffset, encoding, dir);\n    } else if (typeof val === \"number\") {\n      val = val & 255;\n      if (typeof GlobalUint8Array.prototype.indexOf === \"function\") {\n        if (dir) {\n          return GlobalUint8Array.prototype.indexOf.call(buffer2, val, byteOffset);\n        } else {\n          return GlobalUint8Array.prototype.lastIndexOf.call(buffer2, val, byteOffset);\n        }\n      }\n      return arrayIndexOf(buffer2, [val], byteOffset, encoding, dir);\n    }\n    throw new TypeError(\"val must be string, number or Buffer\");\n  }\n  function arrayIndexOf(arr, val, byteOffset, encoding, dir) {\n    let indexSize = 1;\n    let arrLength = arr.length;\n    let valLength = val.length;\n    if (encoding !== void 0) {\n      encoding = String(encoding).toLowerCase();\n      if (encoding === \"ucs2\" || encoding === \"ucs-2\" || encoding === \"utf16le\" || encoding === \"utf-16le\") {\n        if (arr.length < 2 || val.length < 2) {\n          return -1;\n        }\n        indexSize = 2;\n        arrLength /= 2;\n        valLength /= 2;\n        byteOffset /= 2;\n      }\n    }\n    function read(buf, i2) {\n      if (indexSize === 1) {\n        return buf[i2];\n      } else {\n        return buf.readUInt16BE(i2 * indexSize);\n      }\n    }\n    let i;\n    if (dir) {\n      let foundIndex = -1;\n      for (i = byteOffset; i < arrLength; i++) {\n        if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n          if (foundIndex === -1) foundIndex = i;\n          if (i - foundIndex + 1 === valLength) return foundIndex * indexSize;\n        } else {\n          if (foundIndex !== -1) i -= i - foundIndex;\n          foundIndex = -1;\n        }\n      }\n    } else {\n      if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength;\n      for (i = byteOffset; i >= 0; i--) {\n        let found = true;\n        for (let j = 0; j < valLength; j++) {\n          if (read(arr, i + j) !== read(val, j)) {\n            found = false;\n            break;\n          }\n        }\n        if (found) return i;\n      }\n    }\n    return -1;\n  }\n  Buffer2.prototype.includes = function includes(val, byteOffset, encoding) {\n    return this.indexOf(val, byteOffset, encoding) !== -1;\n  };\n  Buffer2.prototype.indexOf = function indexOf(val, byteOffset, encoding) {\n    return bidirectionalIndexOf(this, val, byteOffset, encoding, true);\n  };\n  Buffer2.prototype.lastIndexOf = function lastIndexOf(val, byteOffset, encoding) {\n    return bidirectionalIndexOf(this, val, byteOffset, encoding, false);\n  };\n  function hexWrite(buf, string, offset, length) {\n    offset = Number(offset) || 0;\n    const remaining = buf.length - offset;\n    if (!length) {\n      length = remaining;\n    } else {\n      length = Number(length);\n      if (length > remaining) {\n        length = remaining;\n      }\n    }\n    const strLen = string.length;\n    if (length > strLen / 2) {\n      length = strLen / 2;\n    }\n    let i;\n    for (i = 0; i < length; ++i) {\n      const parsed = parseInt(string.substr(i * 2, 2), 16);\n      if (numberIsNaN(parsed)) return i;\n      buf[offset + i] = parsed;\n    }\n    return i;\n  }\n  function utf8Write(buf, string, offset, length) {\n    return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length);\n  }\n  function asciiWrite(buf, string, offset, length) {\n    return blitBuffer(asciiToBytes(string), buf, offset, length);\n  }\n  function base64Write(buf, string, offset, length) {\n    return blitBuffer(base64ToBytes(string), buf, offset, length);\n  }\n  function ucs2Write(buf, string, offset, length) {\n    return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length);\n  }\n  Buffer2.prototype.write = function write(string, offset, length, encoding) {\n    if (offset === void 0) {\n      encoding = \"utf8\";\n      length = this.length;\n      offset = 0;\n    } else if (length === void 0 && typeof offset === \"string\") {\n      encoding = offset;\n      length = this.length;\n      offset = 0;\n    } else if (isFinite(offset)) {\n      offset = offset >>> 0;\n      if (isFinite(length)) {\n        length = length >>> 0;\n        if (encoding === void 0) encoding = \"utf8\";\n      } else {\n        encoding = length;\n        length = void 0;\n      }\n    } else {\n      throw new Error(\n        \"Buffer.write(string, encoding, offset[, length]) is no longer supported\"\n      );\n    }\n    const remaining = this.length - offset;\n    if (length === void 0 || length > remaining) length = remaining;\n    if (string.length > 0 && (length < 0 || offset < 0) || offset > this.length) {\n      throw new RangeError(\"Attempt to write outside buffer bounds\");\n    }\n    if (!encoding) encoding = \"utf8\";\n    let loweredCase = false;\n    for (; ; ) {\n      switch (encoding) {\n        case \"hex\":\n          return hexWrite(this, string, offset, length);\n        case \"utf8\":\n        case \"utf-8\":\n          return utf8Write(this, string, offset, length);\n        case \"ascii\":\n        case \"latin1\":\n        case \"binary\":\n          return asciiWrite(this, string, offset, length);\n        case \"base64\":\n          return base64Write(this, string, offset, length);\n        case \"ucs2\":\n        case \"ucs-2\":\n        case \"utf16le\":\n        case \"utf-16le\":\n          return ucs2Write(this, string, offset, length);\n        default:\n          if (loweredCase) throw new TypeError(\"Unknown encoding: \" + encoding);\n          encoding = (\"\" + encoding).toLowerCase();\n          loweredCase = true;\n      }\n    }\n  };\n  Buffer2.prototype.toJSON = function toJSON() {\n    return {\n      type: \"Buffer\",\n      data: Array.prototype.slice.call(this._arr || this, 0)\n    };\n  };\n  function base64Slice(buf, start, end) {\n    if (start === 0 && end === buf.length) {\n      return base64.fromByteArray(buf);\n    } else {\n      return base64.fromByteArray(buf.slice(start, end));\n    }\n  }\n  function utf8Slice(buf, start, end) {\n    end = Math.min(buf.length, end);\n    const res = [];\n    let i = start;\n    while (i < end) {\n      const firstByte = buf[i];\n      let codePoint = null;\n      let bytesPerSequence = firstByte > 239 ? 4 : firstByte > 223 ? 3 : firstByte > 191 ? 2 : 1;\n      if (i + bytesPerSequence <= end) {\n        let secondByte, thirdByte, fourthByte, tempCodePoint;\n        switch (bytesPerSequence) {\n          case 1:\n            if (firstByte < 128) {\n              codePoint = firstByte;\n            }\n            break;\n          case 2:\n            secondByte = buf[i + 1];\n            if ((secondByte & 192) === 128) {\n              tempCodePoint = (firstByte & 31) << 6 | secondByte & 63;\n              if (tempCodePoint > 127) {\n                codePoint = tempCodePoint;\n              }\n            }\n            break;\n          case 3:\n            secondByte = buf[i + 1];\n            thirdByte = buf[i + 2];\n            if ((secondByte & 192) === 128 && (thirdByte & 192) === 128) {\n              tempCodePoint = (firstByte & 15) << 12 | (secondByte & 63) << 6 | thirdByte & 63;\n              if (tempCodePoint > 2047 && (tempCodePoint < 55296 || tempCodePoint > 57343)) {\n                codePoint = tempCodePoint;\n              }\n            }\n            break;\n          case 4:\n            secondByte = buf[i + 1];\n            thirdByte = buf[i + 2];\n            fourthByte = buf[i + 3];\n            if ((secondByte & 192) === 128 && (thirdByte & 192) === 128 && (fourthByte & 192) === 128) {\n              tempCodePoint = (firstByte & 15) << 18 | (secondByte & 63) << 12 | (thirdByte & 63) << 6 | fourthByte & 63;\n              if (tempCodePoint > 65535 && tempCodePoint < 1114112) {\n                codePoint = tempCodePoint;\n              }\n            }\n        }\n      }\n      if (codePoint === null) {\n        codePoint = 65533;\n        bytesPerSequence = 1;\n      } else if (codePoint > 65535) {\n        codePoint -= 65536;\n        res.push(codePoint >>> 10 & 1023 | 55296);\n        codePoint = 56320 | codePoint & 1023;\n      }\n      res.push(codePoint);\n      i += bytesPerSequence;\n    }\n    return decodeCodePointsArray(res);\n  }\n  const MAX_ARGUMENTS_LENGTH = 4096;\n  function decodeCodePointsArray(codePoints) {\n    const len = codePoints.length;\n    if (len <= MAX_ARGUMENTS_LENGTH) {\n      return String.fromCharCode.apply(String, codePoints);\n    }\n    let res = \"\";\n    let i = 0;\n    while (i < len) {\n      res += String.fromCharCode.apply(\n        String,\n        codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n      );\n    }\n    return res;\n  }\n  function asciiSlice(buf, start, end) {\n    let ret = \"\";\n    end = Math.min(buf.length, end);\n    for (let i = start; i < end; ++i) {\n      ret += String.fromCharCode(buf[i] & 127);\n    }\n    return ret;\n  }\n  function latin1Slice(buf, start, end) {\n    let ret = \"\";\n    end = Math.min(buf.length, end);\n    for (let i = start; i < end; ++i) {\n      ret += String.fromCharCode(buf[i]);\n    }\n    return ret;\n  }\n  function hexSlice(buf, start, end) {\n    const len = buf.length;\n    if (!start || start < 0) start = 0;\n    if (!end || end < 0 || end > len) end = len;\n    let out = \"\";\n    for (let i = start; i < end; ++i) {\n      out += hexSliceLookupTable[buf[i]];\n    }\n    return out;\n  }\n  function utf16leSlice(buf, start, end) {\n    const bytes = buf.slice(start, end);\n    let res = \"\";\n    for (let i = 0; i < bytes.length - 1; i += 2) {\n      res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256);\n    }\n    return res;\n  }\n  Buffer2.prototype.slice = function slice(start, end) {\n    const len = this.length;\n    start = ~~start;\n    end = end === void 0 ? len : ~~end;\n    if (start < 0) {\n      start += len;\n      if (start < 0) start = 0;\n    } else if (start > len) {\n      start = len;\n    }\n    if (end < 0) {\n      end += len;\n      if (end < 0) end = 0;\n    } else if (end > len) {\n      end = len;\n    }\n    if (end < start) end = start;\n    const newBuf = this.subarray(start, end);\n    Object.setPrototypeOf(newBuf, Buffer2.prototype);\n    return newBuf;\n  };\n  function checkOffset(offset, ext, length) {\n    if (offset % 1 !== 0 || offset < 0) throw new RangeError(\"offset is not uint\");\n    if (offset + ext > length) throw new RangeError(\"Trying to access beyond buffer length\");\n  }\n  Buffer2.prototype.readUintLE = Buffer2.prototype.readUIntLE = function readUIntLE(offset, byteLength3, noAssert) {\n    offset = offset >>> 0;\n    byteLength3 = byteLength3 >>> 0;\n    if (!noAssert) checkOffset(offset, byteLength3, this.length);\n    let val = this[offset];\n    let mul = 1;\n    let i = 0;\n    while (++i < byteLength3 && (mul *= 256)) {\n      val += this[offset + i] * mul;\n    }\n    return val;\n  };\n  Buffer2.prototype.readUintBE = Buffer2.prototype.readUIntBE = function readUIntBE(offset, byteLength3, noAssert) {\n    offset = offset >>> 0;\n    byteLength3 = byteLength3 >>> 0;\n    if (!noAssert) {\n      checkOffset(offset, byteLength3, this.length);\n    }\n    let val = this[offset + --byteLength3];\n    let mul = 1;\n    while (byteLength3 > 0 && (mul *= 256)) {\n      val += this[offset + --byteLength3] * mul;\n    }\n    return val;\n  };\n  Buffer2.prototype.readUint8 = Buffer2.prototype.readUInt8 = function readUInt8(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 1, this.length);\n    return this[offset];\n  };\n  Buffer2.prototype.readUint16LE = Buffer2.prototype.readUInt16LE = function readUInt16LE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 2, this.length);\n    return this[offset] | this[offset + 1] << 8;\n  };\n  Buffer2.prototype.readUint16BE = Buffer2.prototype.readUInt16BE = function readUInt16BE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 2, this.length);\n    return this[offset] << 8 | this[offset + 1];\n  };\n  Buffer2.prototype.readUint32LE = Buffer2.prototype.readUInt32LE = function readUInt32LE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 4, this.length);\n    return (this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16) + this[offset + 3] * 16777216;\n  };\n  Buffer2.prototype.readUint32BE = Buffer2.prototype.readUInt32BE = function readUInt32BE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 4, this.length);\n    return this[offset] * 16777216 + (this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3]);\n  };\n  Buffer2.prototype.readBigUInt64LE = defineBigIntMethod(function readBigUInt64LE(offset) {\n    offset = offset >>> 0;\n    validateNumber(offset, \"offset\");\n    const first = this[offset];\n    const last = this[offset + 7];\n    if (first === void 0 || last === void 0) {\n      boundsError(offset, this.length - 8);\n    }\n    const lo = first + this[++offset] * 2 ** 8 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 24;\n    const hi = this[++offset] + this[++offset] * 2 ** 8 + this[++offset] * 2 ** 16 + last * 2 ** 24;\n    return BigInt(lo) + (BigInt(hi) << BigInt(32));\n  });\n  Buffer2.prototype.readBigUInt64BE = defineBigIntMethod(function readBigUInt64BE(offset) {\n    offset = offset >>> 0;\n    validateNumber(offset, \"offset\");\n    const first = this[offset];\n    const last = this[offset + 7];\n    if (first === void 0 || last === void 0) {\n      boundsError(offset, this.length - 8);\n    }\n    const hi = first * 2 ** 24 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 8 + this[++offset];\n    const lo = this[++offset] * 2 ** 24 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 8 + last;\n    return (BigInt(hi) << BigInt(32)) + BigInt(lo);\n  });\n  Buffer2.prototype.readIntLE = function readIntLE(offset, byteLength3, noAssert) {\n    offset = offset >>> 0;\n    byteLength3 = byteLength3 >>> 0;\n    if (!noAssert) checkOffset(offset, byteLength3, this.length);\n    let val = this[offset];\n    let mul = 1;\n    let i = 0;\n    while (++i < byteLength3 && (mul *= 256)) {\n      val += this[offset + i] * mul;\n    }\n    mul *= 128;\n    if (val >= mul) val -= Math.pow(2, 8 * byteLength3);\n    return val;\n  };\n  Buffer2.prototype.readIntBE = function readIntBE(offset, byteLength3, noAssert) {\n    offset = offset >>> 0;\n    byteLength3 = byteLength3 >>> 0;\n    if (!noAssert) checkOffset(offset, byteLength3, this.length);\n    let i = byteLength3;\n    let mul = 1;\n    let val = this[offset + --i];\n    while (i > 0 && (mul *= 256)) {\n      val += this[offset + --i] * mul;\n    }\n    mul *= 128;\n    if (val >= mul) val -= Math.pow(2, 8 * byteLength3);\n    return val;\n  };\n  Buffer2.prototype.readInt8 = function readInt8(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 1, this.length);\n    if (!(this[offset] & 128)) return this[offset];\n    return (255 - this[offset] + 1) * -1;\n  };\n  Buffer2.prototype.readInt16LE = function readInt16LE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 2, this.length);\n    const val = this[offset] | this[offset + 1] << 8;\n    return val & 32768 ? val | 4294901760 : val;\n  };\n  Buffer2.prototype.readInt16BE = function readInt16BE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 2, this.length);\n    const val = this[offset + 1] | this[offset] << 8;\n    return val & 32768 ? val | 4294901760 : val;\n  };\n  Buffer2.prototype.readInt32LE = function readInt32LE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 4, this.length);\n    return this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16 | this[offset + 3] << 24;\n  };\n  Buffer2.prototype.readInt32BE = function readInt32BE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 4, this.length);\n    return this[offset] << 24 | this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3];\n  };\n  Buffer2.prototype.readBigInt64LE = defineBigIntMethod(function readBigInt64LE(offset) {\n    offset = offset >>> 0;\n    validateNumber(offset, \"offset\");\n    const first = this[offset];\n    const last = this[offset + 7];\n    if (first === void 0 || last === void 0) {\n      boundsError(offset, this.length - 8);\n    }\n    const val = this[offset + 4] + this[offset + 5] * 2 ** 8 + this[offset + 6] * 2 ** 16 + (last << 24);\n    return (BigInt(val) << BigInt(32)) + BigInt(first + this[++offset] * 2 ** 8 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 24);\n  });\n  Buffer2.prototype.readBigInt64BE = defineBigIntMethod(function readBigInt64BE(offset) {\n    offset = offset >>> 0;\n    validateNumber(offset, \"offset\");\n    const first = this[offset];\n    const last = this[offset + 7];\n    if (first === void 0 || last === void 0) {\n      boundsError(offset, this.length - 8);\n    }\n    const val = (first << 24) + // Overflow\n    this[++offset] * 2 ** 16 + this[++offset] * 2 ** 8 + this[++offset];\n    return (BigInt(val) << BigInt(32)) + BigInt(this[++offset] * 2 ** 24 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 8 + last);\n  });\n  Buffer2.prototype.readFloatLE = function readFloatLE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 4, this.length);\n    return ieee754$1.read(this, offset, true, 23, 4);\n  };\n  Buffer2.prototype.readFloatBE = function readFloatBE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 4, this.length);\n    return ieee754$1.read(this, offset, false, 23, 4);\n  };\n  Buffer2.prototype.readDoubleLE = function readDoubleLE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 8, this.length);\n    return ieee754$1.read(this, offset, true, 52, 8);\n  };\n  Buffer2.prototype.readDoubleBE = function readDoubleBE(offset, noAssert) {\n    offset = offset >>> 0;\n    if (!noAssert) checkOffset(offset, 8, this.length);\n    return ieee754$1.read(this, offset, false, 52, 8);\n  };\n  function checkInt(buf, value, offset, ext, max, min) {\n    if (!Buffer2.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance');\n    if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds');\n    if (offset + ext > buf.length) throw new RangeError(\"Index out of range\");\n  }\n  Buffer2.prototype.writeUintLE = Buffer2.prototype.writeUIntLE = function writeUIntLE(value, offset, byteLength3, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    byteLength3 = byteLength3 >>> 0;\n    if (!noAssert) {\n      const maxBytes = Math.pow(2, 8 * byteLength3) - 1;\n      checkInt(this, value, offset, byteLength3, maxBytes, 0);\n    }\n    let mul = 1;\n    let i = 0;\n    this[offset] = value & 255;\n    while (++i < byteLength3 && (mul *= 256)) {\n      this[offset + i] = value / mul & 255;\n    }\n    return offset + byteLength3;\n  };\n  Buffer2.prototype.writeUintBE = Buffer2.prototype.writeUIntBE = function writeUIntBE(value, offset, byteLength3, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    byteLength3 = byteLength3 >>> 0;\n    if (!noAssert) {\n      const maxBytes = Math.pow(2, 8 * byteLength3) - 1;\n      checkInt(this, value, offset, byteLength3, maxBytes, 0);\n    }\n    let i = byteLength3 - 1;\n    let mul = 1;\n    this[offset + i] = value & 255;\n    while (--i >= 0 && (mul *= 256)) {\n      this[offset + i] = value / mul & 255;\n    }\n    return offset + byteLength3;\n  };\n  Buffer2.prototype.writeUint8 = Buffer2.prototype.writeUInt8 = function writeUInt8(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 1, 255, 0);\n    this[offset] = value & 255;\n    return offset + 1;\n  };\n  Buffer2.prototype.writeUint16LE = Buffer2.prototype.writeUInt16LE = function writeUInt16LE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 2, 65535, 0);\n    this[offset] = value & 255;\n    this[offset + 1] = value >>> 8;\n    return offset + 2;\n  };\n  Buffer2.prototype.writeUint16BE = Buffer2.prototype.writeUInt16BE = function writeUInt16BE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 2, 65535, 0);\n    this[offset] = value >>> 8;\n    this[offset + 1] = value & 255;\n    return offset + 2;\n  };\n  Buffer2.prototype.writeUint32LE = Buffer2.prototype.writeUInt32LE = function writeUInt32LE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 4, 4294967295, 0);\n    this[offset + 3] = value >>> 24;\n    this[offset + 2] = value >>> 16;\n    this[offset + 1] = value >>> 8;\n    this[offset] = value & 255;\n    return offset + 4;\n  };\n  Buffer2.prototype.writeUint32BE = Buffer2.prototype.writeUInt32BE = function writeUInt32BE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 4, 4294967295, 0);\n    this[offset] = value >>> 24;\n    this[offset + 1] = value >>> 16;\n    this[offset + 2] = value >>> 8;\n    this[offset + 3] = value & 255;\n    return offset + 4;\n  };\n  function wrtBigUInt64LE(buf, value, offset, min, max) {\n    checkIntBI(value, min, max, buf, offset, 7);\n    let lo = Number(value & BigInt(4294967295));\n    buf[offset++] = lo;\n    lo = lo >> 8;\n    buf[offset++] = lo;\n    lo = lo >> 8;\n    buf[offset++] = lo;\n    lo = lo >> 8;\n    buf[offset++] = lo;\n    let hi = Number(value >> BigInt(32) & BigInt(4294967295));\n    buf[offset++] = hi;\n    hi = hi >> 8;\n    buf[offset++] = hi;\n    hi = hi >> 8;\n    buf[offset++] = hi;\n    hi = hi >> 8;\n    buf[offset++] = hi;\n    return offset;\n  }\n  function wrtBigUInt64BE(buf, value, offset, min, max) {\n    checkIntBI(value, min, max, buf, offset, 7);\n    let lo = Number(value & BigInt(4294967295));\n    buf[offset + 7] = lo;\n    lo = lo >> 8;\n    buf[offset + 6] = lo;\n    lo = lo >> 8;\n    buf[offset + 5] = lo;\n    lo = lo >> 8;\n    buf[offset + 4] = lo;\n    let hi = Number(value >> BigInt(32) & BigInt(4294967295));\n    buf[offset + 3] = hi;\n    hi = hi >> 8;\n    buf[offset + 2] = hi;\n    hi = hi >> 8;\n    buf[offset + 1] = hi;\n    hi = hi >> 8;\n    buf[offset] = hi;\n    return offset + 8;\n  }\n  Buffer2.prototype.writeBigUInt64LE = defineBigIntMethod(function writeBigUInt64LE(value, offset = 0) {\n    return wrtBigUInt64LE(this, value, offset, BigInt(0), BigInt(\"0xffffffffffffffff\"));\n  });\n  Buffer2.prototype.writeBigUInt64BE = defineBigIntMethod(function writeBigUInt64BE(value, offset = 0) {\n    return wrtBigUInt64BE(this, value, offset, BigInt(0), BigInt(\"0xffffffffffffffff\"));\n  });\n  Buffer2.prototype.writeIntLE = function writeIntLE(value, offset, byteLength3, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) {\n      const limit = Math.pow(2, 8 * byteLength3 - 1);\n      checkInt(this, value, offset, byteLength3, limit - 1, -limit);\n    }\n    let i = 0;\n    let mul = 1;\n    let sub = 0;\n    this[offset] = value & 255;\n    while (++i < byteLength3 && (mul *= 256)) {\n      if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n        sub = 1;\n      }\n      this[offset + i] = (value / mul >> 0) - sub & 255;\n    }\n    return offset + byteLength3;\n  };\n  Buffer2.prototype.writeIntBE = function writeIntBE(value, offset, byteLength3, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) {\n      const limit = Math.pow(2, 8 * byteLength3 - 1);\n      checkInt(this, value, offset, byteLength3, limit - 1, -limit);\n    }\n    let i = byteLength3 - 1;\n    let mul = 1;\n    let sub = 0;\n    this[offset + i] = value & 255;\n    while (--i >= 0 && (mul *= 256)) {\n      if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n        sub = 1;\n      }\n      this[offset + i] = (value / mul >> 0) - sub & 255;\n    }\n    return offset + byteLength3;\n  };\n  Buffer2.prototype.writeInt8 = function writeInt8(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 1, 127, -128);\n    if (value < 0) value = 255 + value + 1;\n    this[offset] = value & 255;\n    return offset + 1;\n  };\n  Buffer2.prototype.writeInt16LE = function writeInt16LE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 2, 32767, -32768);\n    this[offset] = value & 255;\n    this[offset + 1] = value >>> 8;\n    return offset + 2;\n  };\n  Buffer2.prototype.writeInt16BE = function writeInt16BE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 2, 32767, -32768);\n    this[offset] = value >>> 8;\n    this[offset + 1] = value & 255;\n    return offset + 2;\n  };\n  Buffer2.prototype.writeInt32LE = function writeInt32LE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 4, 2147483647, -2147483648);\n    this[offset] = value & 255;\n    this[offset + 1] = value >>> 8;\n    this[offset + 2] = value >>> 16;\n    this[offset + 3] = value >>> 24;\n    return offset + 4;\n  };\n  Buffer2.prototype.writeInt32BE = function writeInt32BE(value, offset, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) checkInt(this, value, offset, 4, 2147483647, -2147483648);\n    if (value < 0) value = 4294967295 + value + 1;\n    this[offset] = value >>> 24;\n    this[offset + 1] = value >>> 16;\n    this[offset + 2] = value >>> 8;\n    this[offset + 3] = value & 255;\n    return offset + 4;\n  };\n  Buffer2.prototype.writeBigInt64LE = defineBigIntMethod(function writeBigInt64LE(value, offset = 0) {\n    return wrtBigUInt64LE(this, value, offset, -BigInt(\"0x8000000000000000\"), BigInt(\"0x7fffffffffffffff\"));\n  });\n  Buffer2.prototype.writeBigInt64BE = defineBigIntMethod(function writeBigInt64BE(value, offset = 0) {\n    return wrtBigUInt64BE(this, value, offset, -BigInt(\"0x8000000000000000\"), BigInt(\"0x7fffffffffffffff\"));\n  });\n  function checkIEEE754(buf, value, offset, ext, max, min) {\n    if (offset + ext > buf.length) throw new RangeError(\"Index out of range\");\n    if (offset < 0) throw new RangeError(\"Index out of range\");\n  }\n  function writeFloat(buf, value, offset, littleEndian, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) {\n      checkIEEE754(buf, value, offset, 4);\n    }\n    ieee754$1.write(buf, value, offset, littleEndian, 23, 4);\n    return offset + 4;\n  }\n  Buffer2.prototype.writeFloatLE = function writeFloatLE(value, offset, noAssert) {\n    return writeFloat(this, value, offset, true, noAssert);\n  };\n  Buffer2.prototype.writeFloatBE = function writeFloatBE(value, offset, noAssert) {\n    return writeFloat(this, value, offset, false, noAssert);\n  };\n  function writeDouble(buf, value, offset, littleEndian, noAssert) {\n    value = +value;\n    offset = offset >>> 0;\n    if (!noAssert) {\n      checkIEEE754(buf, value, offset, 8);\n    }\n    ieee754$1.write(buf, value, offset, littleEndian, 52, 8);\n    return offset + 8;\n  }\n  Buffer2.prototype.writeDoubleLE = function writeDoubleLE(value, offset, noAssert) {\n    return writeDouble(this, value, offset, true, noAssert);\n  };\n  Buffer2.prototype.writeDoubleBE = function writeDoubleBE(value, offset, noAssert) {\n    return writeDouble(this, value, offset, false, noAssert);\n  };\n  Buffer2.prototype.copy = function copy(target, targetStart, start, end) {\n    if (!Buffer2.isBuffer(target)) throw new TypeError(\"argument should be a Buffer\");\n    if (!start) start = 0;\n    if (!end && end !== 0) end = this.length;\n    if (targetStart >= target.length) targetStart = target.length;\n    if (!targetStart) targetStart = 0;\n    if (end > 0 && end < start) end = start;\n    if (end === start) return 0;\n    if (target.length === 0 || this.length === 0) return 0;\n    if (targetStart < 0) {\n      throw new RangeError(\"targetStart out of bounds\");\n    }\n    if (start < 0 || start >= this.length) throw new RangeError(\"Index out of range\");\n    if (end < 0) throw new RangeError(\"sourceEnd out of bounds\");\n    if (end > this.length) end = this.length;\n    if (target.length - targetStart < end - start) {\n      end = target.length - targetStart + start;\n    }\n    const len = end - start;\n    if (this === target && typeof GlobalUint8Array.prototype.copyWithin === \"function\") {\n      this.copyWithin(targetStart, start, end);\n    } else {\n      GlobalUint8Array.prototype.set.call(\n        target,\n        this.subarray(start, end),\n        targetStart\n      );\n    }\n    return len;\n  };\n  Buffer2.prototype.fill = function fill(val, start, end, encoding) {\n    if (typeof val === \"string\") {\n      if (typeof start === \"string\") {\n        encoding = start;\n        start = 0;\n        end = this.length;\n      } else if (typeof end === \"string\") {\n        encoding = end;\n        end = this.length;\n      }\n      if (encoding !== void 0 && typeof encoding !== \"string\") {\n        throw new TypeError(\"encoding must be a string\");\n      }\n      if (typeof encoding === \"string\" && !Buffer2.isEncoding(encoding)) {\n        throw new TypeError(\"Unknown encoding: \" + encoding);\n      }\n      if (val.length === 1) {\n        const code2 = val.charCodeAt(0);\n        if (encoding === \"utf8\" && code2 < 128 || encoding === \"latin1\") {\n          val = code2;\n        }\n      }\n    } else if (typeof val === \"number\") {\n      val = val & 255;\n    } else if (typeof val === \"boolean\") {\n      val = Number(val);\n    }\n    if (start < 0 || this.length < start || this.length < end) {\n      throw new RangeError(\"Out of range index\");\n    }\n    if (end <= start) {\n      return this;\n    }\n    start = start >>> 0;\n    end = end === void 0 ? this.length : end >>> 0;\n    if (!val) val = 0;\n    let i;\n    if (typeof val === \"number\") {\n      for (i = start; i < end; ++i) {\n        this[i] = val;\n      }\n    } else {\n      const bytes = Buffer2.isBuffer(val) ? val : Buffer2.from(val, encoding);\n      const len = bytes.length;\n      if (len === 0) {\n        throw new TypeError('The value \"' + val + '\" is invalid for argument \"value\"');\n      }\n      for (i = 0; i < end - start; ++i) {\n        this[i + start] = bytes[i % len];\n      }\n    }\n    return this;\n  };\n  const errors = {};\n  function E(sym, getMessage, Base) {\n    errors[sym] = class NodeError extends Base {\n      constructor() {\n        super();\n        Object.defineProperty(this, \"message\", {\n          value: getMessage.apply(this, arguments),\n          writable: true,\n          configurable: true\n        });\n        this.name = `${this.name} [${sym}]`;\n        this.stack;\n        delete this.name;\n      }\n      get code() {\n        return sym;\n      }\n      set code(value) {\n        Object.defineProperty(this, \"code\", {\n          configurable: true,\n          enumerable: true,\n          value,\n          writable: true\n        });\n      }\n      toString() {\n        return `${this.name} [${sym}]: ${this.message}`;\n      }\n    };\n  }\n  E(\n    \"ERR_BUFFER_OUT_OF_BOUNDS\",\n    function(name) {\n      if (name) {\n        return `${name} is outside of buffer bounds`;\n      }\n      return \"Attempt to access memory outside buffer bounds\";\n    },\n    RangeError\n  );\n  E(\n    \"ERR_INVALID_ARG_TYPE\",\n    function(name, actual) {\n      return `The \"${name}\" argument must be of type number. Received type ${typeof actual}`;\n    },\n    TypeError\n  );\n  E(\n    \"ERR_OUT_OF_RANGE\",\n    function(str, range, input) {\n      let msg = `The value of \"${str}\" is out of range.`;\n      let received = input;\n      if (Number.isInteger(input) && Math.abs(input) > 2 ** 32) {\n        received = addNumericalSeparator(String(input));\n      } else if (typeof input === \"bigint\") {\n        received = String(input);\n        if (input > BigInt(2) ** BigInt(32) || input < -(BigInt(2) ** BigInt(32))) {\n          received = addNumericalSeparator(received);\n        }\n        received += \"n\";\n      }\n      msg += ` It must be ${range}. Received ${received}`;\n      return msg;\n    },\n    RangeError\n  );\n  function addNumericalSeparator(val) {\n    let res = \"\";\n    let i = val.length;\n    const start = val[0] === \"-\" ? 1 : 0;\n    for (; i >= start + 4; i -= 3) {\n      res = `_${val.slice(i - 3, i)}${res}`;\n    }\n    return `${val.slice(0, i)}${res}`;\n  }\n  function checkBounds(buf, offset, byteLength3) {\n    validateNumber(offset, \"offset\");\n    if (buf[offset] === void 0 || buf[offset + byteLength3] === void 0) {\n      boundsError(offset, buf.length - (byteLength3 + 1));\n    }\n  }\n  function checkIntBI(value, min, max, buf, offset, byteLength3) {\n    if (value > max || value < min) {\n      const n = typeof min === \"bigint\" ? \"n\" : \"\";\n      let range;\n      {\n        if (min === 0 || min === BigInt(0)) {\n          range = `>= 0${n} and < 2${n} ** ${(byteLength3 + 1) * 8}${n}`;\n        } else {\n          range = `>= -(2${n} ** ${(byteLength3 + 1) * 8 - 1}${n}) and < 2 ** ${(byteLength3 + 1) * 8 - 1}${n}`;\n        }\n      }\n      throw new errors.ERR_OUT_OF_RANGE(\"value\", range, value);\n    }\n    checkBounds(buf, offset, byteLength3);\n  }\n  function validateNumber(value, name) {\n    if (typeof value !== \"number\") {\n      throw new errors.ERR_INVALID_ARG_TYPE(name, \"number\", value);\n    }\n  }\n  function boundsError(value, length, type) {\n    if (Math.floor(value) !== value) {\n      validateNumber(value, type);\n      throw new errors.ERR_OUT_OF_RANGE(\"offset\", \"an integer\", value);\n    }\n    if (length < 0) {\n      throw new errors.ERR_BUFFER_OUT_OF_BOUNDS();\n    }\n    throw new errors.ERR_OUT_OF_RANGE(\n      \"offset\",\n      `>= ${0} and <= ${length}`,\n      value\n    );\n  }\n  const INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g;\n  function base64clean(str) {\n    str = str.split(\"=\")[0];\n    str = str.trim().replace(INVALID_BASE64_RE, \"\");\n    if (str.length < 2) return \"\";\n    while (str.length % 4 !== 0) {\n      str = str + \"=\";\n    }\n    return str;\n  }\n  function utf8ToBytes(string, units) {\n    units = units || Infinity;\n    let codePoint;\n    const length = string.length;\n    let leadSurrogate = null;\n    const bytes = [];\n    for (let i = 0; i < length; ++i) {\n      codePoint = string.charCodeAt(i);\n      if (codePoint > 55295 && codePoint < 57344) {\n        if (!leadSurrogate) {\n          if (codePoint > 56319) {\n            if ((units -= 3) > -1) bytes.push(239, 191, 189);\n            continue;\n          } else if (i + 1 === length) {\n            if ((units -= 3) > -1) bytes.push(239, 191, 189);\n            continue;\n          }\n          leadSurrogate = codePoint;\n          continue;\n        }\n        if (codePoint < 56320) {\n          if ((units -= 3) > -1) bytes.push(239, 191, 189);\n          leadSurrogate = codePoint;\n          continue;\n        }\n        codePoint = (leadSurrogate - 55296 << 10 | codePoint - 56320) + 65536;\n      } else if (leadSurrogate) {\n        if ((units -= 3) > -1) bytes.push(239, 191, 189);\n      }\n      leadSurrogate = null;\n      if (codePoint < 128) {\n        if ((units -= 1) < 0) break;\n        bytes.push(codePoint);\n      } else if (codePoint < 2048) {\n        if ((units -= 2) < 0) break;\n        bytes.push(\n          codePoint >> 6 | 192,\n          codePoint & 63 | 128\n        );\n      } else if (codePoint < 65536) {\n        if ((units -= 3) < 0) break;\n        bytes.push(\n          codePoint >> 12 | 224,\n          codePoint >> 6 & 63 | 128,\n          codePoint & 63 | 128\n        );\n      } else if (codePoint < 1114112) {\n        if ((units -= 4) < 0) break;\n        bytes.push(\n          codePoint >> 18 | 240,\n          codePoint >> 12 & 63 | 128,\n          codePoint >> 6 & 63 | 128,\n          codePoint & 63 | 128\n        );\n      } else {\n        throw new Error(\"Invalid code point\");\n      }\n    }\n    return bytes;\n  }\n  function asciiToBytes(str) {\n    const byteArray = [];\n    for (let i = 0; i < str.length; ++i) {\n      byteArray.push(str.charCodeAt(i) & 255);\n    }\n    return byteArray;\n  }\n  function utf16leToBytes(str, units) {\n    let c, hi, lo;\n    const byteArray = [];\n    for (let i = 0; i < str.length; ++i) {\n      if ((units -= 2) < 0) break;\n      c = str.charCodeAt(i);\n      hi = c >> 8;\n      lo = c % 256;\n      byteArray.push(lo);\n      byteArray.push(hi);\n    }\n    return byteArray;\n  }\n  function base64ToBytes(str) {\n    return base64.toByteArray(base64clean(str));\n  }\n  function blitBuffer(src, dst, offset, length) {\n    let i;\n    for (i = 0; i < length; ++i) {\n      if (i + offset >= dst.length || i >= src.length) break;\n      dst[i + offset] = src[i];\n    }\n    return i;\n  }\n  function isInstance(obj, type) {\n    return obj instanceof type || obj != null && obj.constructor != null && obj.constructor.name != null && obj.constructor.name === type.name;\n  }\n  function numberIsNaN(obj) {\n    return obj !== obj;\n  }\n  const hexSliceLookupTable = function() {\n    const alphabet = \"0123456789abcdef\";\n    const table = new Array(256);\n    for (let i = 0; i < 16; ++i) {\n      const i16 = i * 16;\n      for (let j = 0; j < 16; ++j) {\n        table[i16 + j] = alphabet[i] + alphabet[j];\n      }\n    }\n    return table;\n  }();\n  function defineBigIntMethod(fn) {\n    return typeof BigInt === \"undefined\" ? BufferBigIntNotDefined : fn;\n  }\n  function BufferBigIntNotDefined() {\n    throw new Error(\"BigInt not supported\");\n  }\n})(buffer);\nconst Buffer$1 = buffer.Buffer;\nclass StorageAPI {\n  constructor(apiHost, environmentId) {\n    __publicField(this, \"apiHost\");\n    __publicField(this, \"environmentId\");\n    this.apiHost = apiHost;\n    this.environmentId = environmentId;\n  }\n  async uploadFile(file, { allowedFileExtensions, surveyId } = {}) {\n    if (!file.name || !file.type || !file.base64) {\n      throw new Error(`Invalid file object`);\n    }\n    const payload = {\n      fileName: file.name,\n      fileType: file.type,\n      allowedFileExtensions,\n      surveyId\n    };\n    const response = await fetch(`${this.apiHost}/api/v1/client/${this.environmentId}/storage`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(payload)\n    });\n    if (!response.ok) {\n      throw new Error(`Upload failed with status: ${String(response.status)}`);\n    }\n    const json = await response.json();\n    const { data } = json;\n    const { signedUrl, fileUrl, signingData, presignedFields, updatedFileName } = data;\n    let requestHeaders = {};\n    if (signingData) {\n      const { signature, timestamp, uuid } = signingData;\n      requestHeaders = {\n        \"X-File-Type\": file.type,\n        \"X-File-Name\": encodeURIComponent(updatedFileName),\n        \"X-Survey-ID\": surveyId ?? \"\",\n        \"X-Signature\": signature,\n        \"X-Timestamp\": String(timestamp),\n        \"X-UUID\": uuid\n      };\n    }\n    const formData = {};\n    const formDataForS3 = new FormData();\n    if (presignedFields) {\n      Object.keys(presignedFields).forEach((key) => {\n        formDataForS3.append(key, presignedFields[key]);\n      });\n      try {\n        const buffer2 = Buffer$1.from(file.base64.split(\",\")[1], \"base64\");\n        const blob = new Blob([buffer2], { type: file.type });\n        formDataForS3.append(\"file\", blob);\n      } catch (buffErr) {\n        console.error({ buffErr });\n        throw new Error(\"Error uploading file\");\n      }\n    }\n    formData.fileBase64String = file.base64;\n    let uploadResponse = {};\n    const signedUrlCopy = signedUrl.replace(\"http://localhost:3000\", this.apiHost);\n    try {\n      uploadResponse = await fetch(signedUrlCopy, {\n        method: \"POST\",\n        ...signingData ? {\n          headers: {\n            ...requestHeaders\n          }\n        } : {},\n        body: presignedFields ? formDataForS3 : JSON.stringify(formData)\n      });\n    } catch (err2) {\n      console.error(\"Error uploading file\", err2);\n    }\n    if (!uploadResponse.ok) {\n      if (signingData) {\n        const uploadJson = await uploadResponse.json();\n        const error = new Error(uploadJson.message);\n        error.name = \"FileTooLargeError\";\n        throw error;\n      }\n      const errorText = await uploadResponse.text();\n      if (presignedFields && errorText.includes(\"EntityTooLarge\")) {\n        const error = new Error(\"File size exceeds the size limit for your plan\");\n        error.name = \"FileTooLargeError\";\n        throw error;\n      }\n      throw new Error(`Upload failed with status: ${String(uploadResponse.status)}`);\n    }\n    return fileUrl;\n  }\n}\nclass Client {\n  constructor(options) {\n    __publicField(this, \"response\");\n    __publicField(this, \"display\");\n    __publicField(this, \"people\");\n    __publicField(this, \"storage\");\n    __publicField(this, \"attribute\");\n    const { apiHost, environmentId } = options;\n    this.response = new ResponseAPI(apiHost, environmentId);\n    this.display = new DisplayAPI(apiHost, environmentId);\n    this.people = new PeopleAPI(apiHost, environmentId);\n    this.attribute = new AttributeAPI(apiHost, environmentId);\n    this.storage = new StorageAPI(apiHost, environmentId);\n  }\n}\nclass FormbricksAPI {\n  constructor(options) {\n    __publicField(this, \"client\");\n    this.client = new Client(options);\n  }\n}\nexport {\n  FormbricksAPI\n};\n//# sourceMappingURL=index.js.map\n","export const delay = (ms: number) => {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n};\n\nexport const isFulfilled = <T>(val: PromiseSettledResult<T>): val is PromiseFulfilledResult<T> => {\n  return val.status === \"fulfilled\";\n};\n\nexport const isRejected = <T>(val: PromiseSettledResult<T>): val is PromiseRejectedResult => {\n  return val.status === \"rejected\";\n};\n","import { FormbricksAPI } from \"@formbricks/api\";\nimport { TResponseUpdate } from \"@formbricks/types/responses\";\nimport { SurveyState } from \"./surveyState\";\nimport { delay } from \"./utils/promises\";\n\ninterface QueueConfig {\n  apiHost: string;\n  environmentId: string;\n  retryAttempts: number;\n  onResponseSendingFailed?: (responseUpdate: TResponseUpdate) => void;\n  onResponseSendingFinished?: () => void;\n  setSurveyState?: (state: SurveyState) => void;\n}\n\nexport class ResponseQueue {\n  private queue: TResponseUpdate[] = [];\n  private config: QueueConfig;\n  private surveyState: SurveyState;\n  private isRequestInProgress = false;\n  private api: FormbricksAPI;\n\n  constructor(config: QueueConfig, surveyState: SurveyState) {\n    this.config = config;\n    this.surveyState = surveyState;\n    this.api = new FormbricksAPI({\n      apiHost: config.apiHost,\n      environmentId: config.environmentId,\n    });\n  }\n\n  add(responseUpdate: TResponseUpdate) {\n    // update survey state\n    this.surveyState.accumulateResponse(responseUpdate);\n    if (this.config.setSurveyState) {\n      this.config.setSurveyState(this.surveyState);\n    }\n    // add response to queue\n    this.queue.push(responseUpdate);\n    this.processQueue();\n  }\n\n  async processQueue() {\n    if (this.isRequestInProgress) return;\n    if (this.queue.length === 0) return;\n\n    this.isRequestInProgress = true;\n\n    const responseUpdate = this.queue[0];\n    let attempts = 0;\n\n    while (attempts < this.config.retryAttempts) {\n      const success = await this.sendResponse(responseUpdate);\n      if (success) {\n        this.queue.shift(); // remove the successfully sent response from the queue\n        break; // exit the retry loop\n      }\n      console.error(`Formbricks: Failed to send response. Retrying... ${attempts}`);\n      await delay(1000); // wait for 1 second before retrying\n      attempts++;\n    }\n\n    if (attempts >= this.config.retryAttempts) {\n      // Inform the user after 2 failed attempts\n      console.error(\"Failed to send response after 2 attempts.\");\n      // If the response fails finally, inform the user\n      if (this.config.onResponseSendingFailed) {\n        this.config.onResponseSendingFailed(responseUpdate);\n      }\n      this.isRequestInProgress = false;\n    } else {\n      if (responseUpdate.finished && this.config.onResponseSendingFinished) {\n        this.config.onResponseSendingFinished();\n      }\n      this.isRequestInProgress = false;\n      this.processQueue(); // process the next item in the queue if any\n    }\n  }\n\n  async sendResponse(responseUpdate: TResponseUpdate): Promise<boolean> {\n    try {\n      if (this.surveyState.responseId !== null) {\n        await this.api.client.response.update({ ...responseUpdate, responseId: this.surveyState.responseId });\n      } else {\n        const response = await this.api.client.response.create({\n          ...responseUpdate,\n          surveyId: this.surveyState.surveyId,\n          userId: this.surveyState.userId || null,\n          singleUseId: this.surveyState.singleUseId || null,\n          data: { ...responseUpdate.data, ...responseUpdate.hiddenFields },\n          displayId: this.surveyState.displayId,\n        });\n        if (!response.ok) {\n          throw new Error(\"Could not create response\");\n        }\n        this.surveyState.updateResponseId(response.data.id);\n        if (this.config.setSurveyState) {\n          this.config.setSurveyState(this.surveyState);\n        }\n      }\n      return true;\n    } catch (error) {\n      console.error(error);\n      return false;\n    }\n  }\n\n  // update surveyState\n  updateSurveyState(surveyState: SurveyState) {\n    this.surveyState = surveyState;\n  }\n}\n","import { TResponseUpdate } from \"@formbricks/types/responses\";\n\nexport class SurveyState {\n  responseId: string | null = null;\n  displayId: string | null = null;\n  userId: string | null = null;\n  surveyId: string;\n  responseAcc: TResponseUpdate = { finished: false, data: {}, ttc: {}, variables: {} };\n  singleUseId: string | null;\n\n  constructor(\n    surveyId: string,\n    singleUseId?: string | null,\n    responseId?: string | null,\n    userId?: string | null\n  ) {\n    this.surveyId = surveyId;\n    this.userId = userId ?? null;\n    this.singleUseId = singleUseId ?? null;\n    this.responseId = responseId ?? null;\n  }\n\n  /**\n   * Set the current survey ID\n   * @param id - The survey ID\n   */\n  setSurveyId(id: string) {\n    this.surveyId = id;\n    this.clear(); // Reset the state when setting a new surveyId\n  }\n  /**\n   * Get a copy of the current state\n   */\n  copy() {\n    const copyInstance = new SurveyState(\n      this.surveyId,\n      this.singleUseId ?? undefined,\n      this.responseId ?? undefined,\n      this.userId ?? undefined\n    );\n    copyInstance.responseId = this.responseId;\n    copyInstance.responseAcc = this.responseAcc;\n    return copyInstance;\n  }\n\n  /**\n   * Update the response ID after a successful response creation\n   * @param id - The response ID\n   */\n  updateResponseId(id: string) {\n    this.responseId = id;\n  }\n\n  /**\n   * Update the display ID after a successful display creation\n   * @param id - The display ID\n   */\n  updateDisplayId(id: string) {\n    this.displayId = id;\n  }\n\n  /**\n   * Update the user ID\n   * @param id - The user ID\n   */\n  updateUserId(id: string) {\n    this.userId = id;\n  }\n\n  /**\n   * Accumulate the responses\n   * @param responseUpdate - The new response data to add\n   */\n  accumulateResponse(responseUpdate: TResponseUpdate) {\n    this.responseAcc = {\n      finished: responseUpdate.finished,\n      ttc: responseUpdate.ttc,\n      data: { ...this.responseAcc.data, ...responseUpdate.data },\n      variables: responseUpdate.variables,\n      displayId: responseUpdate.displayId,\n    };\n  }\n\n  /**\n   * Check if the current accumulated response is finished\n   */\n  isResponseFinished() {\n    return this.responseAcc.finished;\n  }\n\n  /**\n   * Clear the current state\n   */\n  clear() {\n    this.responseId = null;\n    this.responseAcc = { finished: false, data: {}, ttc: {}, variables: {} };\n  }\n}\n","import { TProduct } from \"@formbricks/types/product\";\nimport { TSurvey } from \"@formbricks/types/surveys/types\";\n\nexport const getStyling = (product: TProduct, survey: TSurvey) => {\n  // allow style overwrite is disabled from the product\n  if (!product.styling.allowStyleOverwrite) {\n    return product.styling;\n  }\n\n  // allow style overwrite is enabled from the product\n  if (product.styling.allowStyleOverwrite) {\n    // survey style overwrite is disabled\n    if (!survey.styling?.overwriteThemeStyling) {\n      return product.styling;\n    }\n\n    // survey style overwrite is enabled\n    return survey.styling;\n  }\n\n  return product.styling;\n};\n","const monthNames = [\n  \"January\",\n  \"February\",\n  \"March\",\n  \"April\",\n  \"May\",\n  \"June\",\n  \"July\",\n  \"August\",\n  \"September\",\n  \"October\",\n  \"November\",\n  \"December\",\n];\n\n// Helper function to calculate difference in days between two dates\nexport const diffInDays = (date1: Date, date2: Date) => {\n  const diffTime = Math.abs(date2.getTime() - date1.getTime());\n  return Math.floor(diffTime / (1000 * 60 * 60 * 24));\n};\n\n// Helper function to get the month name\nexport const getMonthName = (monthIndex: number) => {\n  return monthNames[monthIndex];\n};\n\nexport const formatDateWithOrdinal = (date: Date): string => {\n  const getOrdinalSuffix = (day: number) => {\n    const suffixes = [\"th\", \"st\", \"nd\", \"rd\"];\n    const relevantDigits = day < 30 ? day % 20 : day % 30;\n    return suffixes[relevantDigits <= 3 ? relevantDigits : 0];\n  };\n\n  const dayOfWeekNames = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n\n  const dayOfWeek = dayOfWeekNames[date.getDay()];\n  const day = date.getDate();\n  const monthIndex = date.getMonth();\n  const year = date.getFullYear();\n\n  return `${dayOfWeek}, ${monthNames[monthIndex]} ${day}${getOrdinalSuffix(day)}, ${year}`;\n};\n\n// Helper function to format the date with an ordinal suffix\nexport const getOrdinalDate = (date: number) => {\n  const j = date % 10,\n    k = date % 100;\n  if (j === 1 && k !== 11) {\n    return date + \"st\";\n  }\n  if (j === 2 && k !== 12) {\n    return date + \"nd\";\n  }\n  if (j === 3 && k !== 13) {\n    return date + \"rd\";\n  }\n  return date + \"th\";\n};\n\nexport const isValidDateString = (value: string) => {\n  const regex = /^(?:\\d{4}-\\d{2}-\\d{2}|\\d{2}-\\d{2}-\\d{4})$/;\n\n  if (!regex.test(value)) {\n    return false;\n  }\n\n  const date = new Date(value);\n  return date;\n};\n","import { diffInDays } from \"@formbricks/lib/utils/datetime\";\nimport {\n  TActionClass,\n  TActionClassNoCodeConfig,\n  TActionClassPageUrlRule,\n} from \"@formbricks/types/action-classes\";\nimport { TAttributes } from \"@formbricks/types/attributes\";\nimport { TJsEnvironmentState, TJsPersonState, TJsTrackProperties } from \"@formbricks/types/js\";\nimport { TResponseHiddenFieldValue } from \"@formbricks/types/responses\";\nimport { TSurvey } from \"@formbricks/types/surveys/types\";\nimport { Logger } from \"./logger\";\n\nconst logger = Logger.getInstance();\n\nexport const checkUrlMatch = (\n  url: string,\n  pageUrlValue: string,\n  pageUrlRule: TActionClassPageUrlRule\n): boolean => {\n  switch (pageUrlRule) {\n    case \"exactMatch\":\n      return url === pageUrlValue;\n    case \"contains\":\n      return url.includes(pageUrlValue);\n    case \"startsWith\":\n      return url.startsWith(pageUrlValue);\n    case \"endsWith\":\n      return url.endsWith(pageUrlValue);\n    case \"notMatch\":\n      return url !== pageUrlValue;\n    case \"notContains\":\n      return !url.includes(pageUrlValue);\n    default:\n      return false;\n  }\n};\n\nexport const handleUrlFilters = (urlFilters: TActionClassNoCodeConfig[\"urlFilters\"]): boolean => {\n  if (!urlFilters || urlFilters.length === 0) {\n    return true;\n  }\n\n  const windowUrl = window.location.href;\n\n  const isMatch = urlFilters.some((filter) => {\n    const match = checkUrlMatch(windowUrl, filter.value, filter.rule);\n    return match;\n  });\n\n  return isMatch;\n};\n\nexport const evaluateNoCodeConfigClick = (targetElement: HTMLElement, action: TActionClass): boolean => {\n  if (action.noCodeConfig?.type !== \"click\") return false;\n\n  const innerHtml = action.noCodeConfig.elementSelector.innerHtml;\n  const cssSelector = action.noCodeConfig.elementSelector.cssSelector;\n  const urlFilters = action.noCodeConfig.urlFilters;\n\n  if (!innerHtml && !cssSelector) return false;\n\n  if (innerHtml && targetElement.innerHTML !== innerHtml) return false;\n\n  if (cssSelector) {\n    // Split selectors that start with a . or # including the . or #\n    const individualSelectors = cssSelector.split(/\\s*(?=[.#])/);\n    for (let selector of individualSelectors) {\n      if (!targetElement.matches(selector)) {\n        return false;\n      }\n    }\n  }\n\n  const isValidUrl = handleUrlFilters(urlFilters);\n\n  if (!isValidUrl) return false;\n\n  return true;\n};\n\nexport const handleHiddenFields = (\n  hiddenFieldsConfig: TSurvey[\"hiddenFields\"],\n  hiddenFields: TJsTrackProperties[\"hiddenFields\"]\n): TResponseHiddenFieldValue => {\n  const { enabled: enabledHiddenFields, fieldIds: hiddenFieldIds } = hiddenFieldsConfig || {};\n\n  let hiddenFieldsObject: TResponseHiddenFieldValue = {};\n\n  if (!enabledHiddenFields) {\n    logger.error(\"Hidden fields are not enabled for this survey\");\n  } else if (hiddenFieldIds && hiddenFields) {\n    const unknownHiddenFields: string[] = [];\n    hiddenFieldsObject = Object.keys(hiddenFields).reduce((acc, key) => {\n      if (hiddenFieldIds?.includes(key)) {\n        acc[key] = hiddenFields?.[key];\n      } else {\n        unknownHiddenFields.push(key);\n      }\n      return acc;\n    }, {} as TResponseHiddenFieldValue);\n\n    if (unknownHiddenFields.length > 0) {\n      logger.error(\n        `Unknown hidden fields: ${unknownHiddenFields.join(\", \")}. Please add them to the survey hidden fields.`\n      );\n    }\n  }\n\n  return hiddenFieldsObject;\n};\n\nexport const shouldDisplayBasedOnPercentage = (displayPercentage: number) => {\n  const randomNum = Math.floor(Math.random() * 10000) / 100;\n  return randomNum <= displayPercentage;\n};\n\nexport const getLanguageCode = (survey: TSurvey, attributes: TAttributes): string | undefined => {\n  const language = attributes.language;\n  const availableLanguageCodes = survey.languages.map((surveyLanguage) => surveyLanguage.language.code);\n  if (!language) return \"default\";\n  else {\n    const selectedLanguage = survey.languages.find((surveyLanguage) => {\n      return (\n        surveyLanguage.language.code === language.toLowerCase() ||\n        surveyLanguage.language.alias?.toLowerCase() === language.toLowerCase()\n      );\n    });\n    if (selectedLanguage?.default) {\n      return \"default\";\n    }\n    if (\n      !selectedLanguage ||\n      !selectedLanguage?.enabled ||\n      !availableLanguageCodes.includes(selectedLanguage.language.code)\n    ) {\n      return undefined;\n    }\n    return selectedLanguage.language.code;\n  }\n};\n\nexport const getDefaultLanguageCode = (survey: TSurvey) => {\n  const defaultSurveyLanguage = survey.languages?.find((surveyLanguage) => {\n    return surveyLanguage.default === true;\n  });\n  if (defaultSurveyLanguage) return defaultSurveyLanguage.language.code;\n};\n\nexport const getIsDebug = () => window.location.search.includes(\"formbricksDebug=true\");\n\n/**\n * Filters surveys based on the displayOption, recontactDays, and segments\n * @param environmentSate The environment state\n * @param personState The person state\n * @returns The filtered surveys\n */\n\n// takes the environment and person state and returns the filtered surveys\nexport const filterSurveys = (\n  environmentState: TJsEnvironmentState,\n  personState: TJsPersonState\n): TSurvey[] => {\n  const { product, surveys } = environmentState.data;\n  const { displays, responses, lastDisplayAt, segments, userId } = personState.data;\n\n  if (!displays) {\n    return [];\n  }\n\n  // Function to filter surveys based on displayOption criteria\n  let filteredSurveys = surveys.filter((survey: TSurvey) => {\n    switch (survey.displayOption) {\n      case \"respondMultiple\":\n        return true;\n      case \"displayOnce\":\n        return displays.filter((display) => display.surveyId === survey.id).length === 0;\n      case \"displayMultiple\":\n        return responses.filter((surveyId) => surveyId === survey.id).length === 0;\n\n      case \"displaySome\":\n        if (survey.displayLimit === null) {\n          return true;\n        }\n\n        // Check if survey response exists, if so, stop here\n        if (responses.filter((surveyId) => surveyId === survey.id).length) {\n          return false;\n        }\n\n        // Otherwise, check if displays length is less than displayLimit\n        return displays.filter((display) => display.surveyId === survey.id).length < survey.displayLimit;\n\n      default:\n        throw Error(\"Invalid displayOption\");\n    }\n  });\n\n  // filter surveys that meet the recontactDays criteria\n  filteredSurveys = filteredSurveys.filter((survey) => {\n    // if no survey was displayed yet, show the survey\n    if (!lastDisplayAt) {\n      return true;\n    }\n    // if survey has recontactDays, check if the last display was more than recontactDays ago\n    else if (survey.recontactDays !== null) {\n      const lastDisplaySurvey = displays.filter((display) => display.surveyId === survey.id)[0];\n      if (!lastDisplaySurvey) {\n        return true;\n      }\n      return diffInDays(new Date(), new Date(lastDisplaySurvey.createdAt)) >= survey.recontactDays;\n    }\n    // use recontactDays of the product if survey does not have recontactDays\n    else if (product.recontactDays !== null) {\n      return diffInDays(new Date(), new Date(lastDisplayAt)) >= product.recontactDays;\n    }\n    // if no recontactDays is set, show the survey\n    else {\n      return true;\n    }\n  });\n\n  if (!userId) {\n    return filteredSurveys;\n  }\n\n  if (!segments.length) {\n    return [];\n  }\n\n  // filter surveys based on segments\n  return filteredSurveys.filter((survey) => {\n    return survey.segment?.id && segments.includes(survey.segment.id);\n  });\n};\n","import { FormbricksAPI } from \"@formbricks/api\";\nimport { ResponseQueue } from \"@formbricks/lib/responseQueue\";\nimport { SurveyState } from \"@formbricks/lib/surveyState\";\nimport { getStyling } from \"@formbricks/lib/utils/styling\";\nimport { TJsFileUploadParams, TJsPersonState, TJsTrackProperties } from \"@formbricks/types/js\";\nimport { TResponseHiddenFieldValue, TResponseUpdate } from \"@formbricks/types/responses\";\nimport { TUploadFileConfig } from \"@formbricks/types/storage\";\nimport { TSurvey } from \"@formbricks/types/surveys/types\";\nimport { Config } from \"./config\";\nimport { CONTAINER_ID } from \"./constants\";\nimport { Logger } from \"./logger\";\nimport {\n  filterSurveys,\n  getDefaultLanguageCode,\n  getLanguageCode,\n  handleHiddenFields,\n  shouldDisplayBasedOnPercentage,\n} from \"./utils\";\n\nconst config = Config.getInstance();\nconst logger = Logger.getInstance();\nlet isSurveyRunning = false;\nlet setIsError = (_: boolean) => {};\nlet setIsResponseSendingFinished = (_: boolean) => {};\n\nexport const setIsSurveyRunning = (value: boolean) => {\n  isSurveyRunning = value;\n};\n\nexport const triggerSurvey = async (\n  survey: TSurvey,\n  action?: string,\n  properties?: TJsTrackProperties\n): Promise<void> => {\n  // Check if the survey should be displayed based on displayPercentage\n  if (survey.displayPercentage) {\n    const shouldDisplaySurvey = shouldDisplayBasedOnPercentage(survey.displayPercentage);\n    if (!shouldDisplaySurvey) {\n      logger.debug(`Survey display of \"${survey.name}\" skipped based on displayPercentage.`);\n      return; // skip displaying the survey\n    }\n  }\n\n  const hiddenFieldsObject: TResponseHiddenFieldValue = handleHiddenFields(\n    survey.hiddenFields,\n    properties?.hiddenFields\n  );\n\n  await renderWidget(survey, action, hiddenFieldsObject);\n};\n\nconst renderWidget = async (\n  survey: TSurvey,\n  action?: string,\n  hiddenFields: TResponseHiddenFieldValue = {}\n) => {\n  if (isSurveyRunning) {\n    logger.debug(\"A survey is already running. Skipping.\");\n    return;\n  }\n  setIsSurveyRunning(true);\n\n  if (survey.delay) {\n    logger.debug(`Delaying survey \"${survey.name}\" by ${survey.delay} seconds.`);\n  }\n\n  const { product } = config.get().environmentState.data ?? {};\n  const { attributes } = config.get().personState.data ?? {};\n\n  const isMultiLanguageSurvey = survey.languages.length > 1;\n  let languageCode = \"default\";\n\n  if (isMultiLanguageSurvey) {\n    const displayLanguage = getLanguageCode(survey, attributes);\n    //if survey is not available in selected language, survey wont be shown\n    if (!displayLanguage) {\n      logger.debug(`Survey \"${survey.name}\" is not available in specified language.`);\n      setIsSurveyRunning(true);\n      return;\n    }\n    languageCode = displayLanguage;\n  }\n\n  const surveyState = new SurveyState(survey.id, null, null, config.get().personState.data.userId);\n\n  const responseQueue = new ResponseQueue(\n    {\n      apiHost: config.get().apiHost,\n      environmentId: config.get().environmentId,\n      retryAttempts: 2,\n      onResponseSendingFailed: () => {\n        setIsError(true);\n      },\n      onResponseSendingFinished: () => {\n        setIsResponseSendingFinished(true);\n      },\n    },\n    surveyState\n  );\n  const productOverwrites = survey.productOverwrites ?? {};\n  const clickOutside = productOverwrites.clickOutsideClose ?? product.clickOutsideClose;\n  const darkOverlay = productOverwrites.darkOverlay ?? product.darkOverlay;\n  const placement = productOverwrites.placement ?? product.placement;\n  const isBrandingEnabled = product.inAppSurveyBranding;\n  const formbricksSurveys = await loadFormbricksSurveysExternally();\n\n  setTimeout(() => {\n    formbricksSurveys.renderSurveyModal({\n      survey,\n      isBrandingEnabled,\n      clickOutside,\n      darkOverlay,\n      languageCode,\n      placement,\n      styling: getStyling(product, survey),\n      getSetIsError: (f: (value: boolean) => void) => {\n        setIsError = f;\n      },\n      getSetIsResponseSendingFinished: (f: (value: boolean) => void) => {\n        setIsResponseSendingFinished = f;\n      },\n      onDisplay: async () => {\n        const { userId } = config.get().personState.data;\n\n        const api = new FormbricksAPI({\n          apiHost: config.get().apiHost,\n          environmentId: config.get().environmentId,\n        });\n\n        const res = await api.client.display.create({\n          surveyId: survey.id,\n          ...(userId && { userId }),\n        });\n\n        if (!res.ok) {\n          throw new Error(\"Could not create display\");\n        }\n\n        const { id } = res.data;\n\n        surveyState.updateDisplayId(id);\n        responseQueue.updateSurveyState(surveyState);\n\n        const existingDisplays = config.get().personState.data.displays;\n        const newDisplay = { surveyId: survey.id, createdAt: new Date() };\n        const displays = existingDisplays ? [...existingDisplays, newDisplay] : [newDisplay];\n        const previousConfig = config.get();\n\n        const updatedPersonState: TJsPersonState = {\n          ...previousConfig.personState,\n          data: {\n            ...previousConfig.personState.data,\n            displays,\n            lastDisplayAt: new Date(),\n          },\n        };\n\n        const filteredSurveys = filterSurveys(previousConfig.environmentState, updatedPersonState);\n\n        config.update({\n          ...previousConfig,\n          environmentState: previousConfig.environmentState,\n          personState: updatedPersonState,\n          filteredSurveys,\n        });\n      },\n      onResponse: (responseUpdate: TResponseUpdate) => {\n        const { userId } = config.get().personState.data;\n\n        const isNewResponse = surveyState.responseId === null;\n\n        if (userId) {\n          surveyState.updateUserId(userId);\n        }\n\n        responseQueue.updateSurveyState(surveyState);\n        responseQueue.add({\n          data: responseUpdate.data,\n          ttc: responseUpdate.ttc,\n          finished: responseUpdate.finished,\n          language:\n            responseUpdate.language === \"default\" ? getDefaultLanguageCode(survey) : responseUpdate.language,\n          meta: {\n            url: window.location.href,\n            action,\n          },\n          variables: responseUpdate.variables,\n          hiddenFields,\n          displayId: surveyState.displayId,\n        });\n\n        if (isNewResponse) {\n          const responses = config.get().personState.data.responses;\n          const newPersonState: TJsPersonState = {\n            ...config.get().personState,\n            data: {\n              ...config.get().personState.data,\n              responses: [...responses, surveyState.surveyId],\n            },\n          };\n\n          const filteredSurveys = filterSurveys(config.get().environmentState, newPersonState);\n\n          config.update({\n            ...config.get(),\n            environmentState: config.get().environmentState,\n            personState: newPersonState,\n            filteredSurveys,\n          });\n        }\n      },\n      onClose: closeSurvey,\n      onFileUpload: async (file: TJsFileUploadParams[\"file\"], params: TUploadFileConfig) => {\n        const api = new FormbricksAPI({\n          apiHost: config.get().apiHost,\n          environmentId: config.get().environmentId,\n        });\n\n        return await api.client.storage.uploadFile(\n          {\n            type: file.type,\n            name: file.name,\n            base64: file.base64,\n          },\n          params\n        );\n      },\n      onRetry: () => {\n        setIsError(false);\n        responseQueue.processQueue();\n      },\n      hiddenFieldsRecord: hiddenFields,\n    });\n  }, survey.delay * 1000);\n};\n\nexport const closeSurvey = async (): Promise<void> => {\n  // remove container element from DOM\n  removeWidgetContainer();\n  addWidgetContainer();\n\n  const { environmentState, personState } = config.get();\n  const filteredSurveys = filterSurveys(environmentState, personState);\n\n  config.update({\n    ...config.get(),\n    environmentState,\n    personState,\n    filteredSurveys,\n  });\n\n  setIsSurveyRunning(false);\n};\n\nexport const addWidgetContainer = (): void => {\n  const containerElement = document.createElement(\"div\");\n  containerElement.id = CONTAINER_ID;\n  document.body.appendChild(containerElement);\n};\n\nexport const removeWidgetContainer = (): void => {\n  document.getElementById(CONTAINER_ID)?.remove();\n};\n\nconst loadFormbricksSurveysExternally = (): Promise<typeof window.formbricksSurveys> => {\n  return new Promise((resolve, reject) => {\n    if (window.formbricksSurveys) {\n      resolve(window.formbricksSurveys);\n    } else {\n      const script = document.createElement(\"script\");\n      script.src = `${config.get().apiHost}/api/packages/surveys`;\n      script.async = true;\n      script.onload = () => resolve(window.formbricksSurveys);\n      script.onerror = (error) => {\n        console.error(\"Failed to load Formbricks Surveys library:\", error);\n        reject(error);\n      };\n      document.head.appendChild(script);\n    }\n  });\n};\n","import { TJsTrackProperties } from \"@formbricks/types/js\";\nimport { Config } from \"./config\";\nimport { InvalidCodeError, NetworkError, Result, err, okVoid } from \"./errors\";\nimport { Logger } from \"./logger\";\nimport { triggerSurvey } from \"./widget\";\n\nconst logger = Logger.getInstance();\nconst config = Config.getInstance();\n\nexport const trackAction = async (\n  name: string,\n  alias?: string,\n  properties?: TJsTrackProperties\n): Promise<Result<void, NetworkError>> => {\n  const aliasName = alias || name;\n\n  logger.debug(`Formbricks: Action \"${aliasName}\" tracked`);\n\n  // get a list of surveys that are collecting insights\n  const activeSurveys = config.get().filteredSurveys;\n\n  if (!!activeSurveys && activeSurveys.length > 0) {\n    for (const survey of activeSurveys) {\n      for (const trigger of survey.triggers) {\n        if (trigger.actionClass.name === name) {\n          await triggerSurvey(survey, name, properties);\n        }\n      }\n    }\n  } else {\n    logger.debug(\"No active surveys to display\");\n  }\n\n  return okVoid();\n};\n\nexport const trackCodeAction = (\n  code: string,\n  properties?: TJsTrackProperties\n): Promise<Result<void, NetworkError>> | Result<void, InvalidCodeError> => {\n  const actionClasses = config.get().environmentState.data.actionClasses;\n\n  const codeActionClasses = actionClasses.filter((action) => action.type === \"code\");\n  const action = codeActionClasses.find((action) => action.key === code);\n\n  if (!action) {\n    return err({\n      code: \"invalid_code\",\n      message: `${code} action unknown. Please add this action in Formbricks first in order to use it in your code.`,\n    });\n  }\n\n  return trackAction(action.name, code, properties);\n};\n\nexport const trackNoCodeAction = (name: string): Promise<Result<void, NetworkError>> => {\n  return trackAction(name);\n};\n","import { TJsPersonState, TJsPersonSyncParams } from \"@formbricks/types/js\";\nimport { Config } from \"./config\";\nimport { err } from \"./errors\";\nimport { Logger } from \"./logger\";\nimport { getIsDebug } from \"./utils\";\n\nconst config = Config.getInstance();\nconst logger = Logger.getInstance();\nlet personStateSyncIntervalId: number | null = null;\n\nexport const DEFAULT_PERSON_STATE_NO_USER_ID: TJsPersonState = {\n  expiresAt: null,\n  data: {\n    userId: null,\n    segments: [],\n    displays: [],\n    responses: [],\n    attributes: {},\n    lastDisplayAt: null,\n  },\n} as const;\n\n/**\n * Fetch the person state from the backend\n * @param apiHost - The API host\n * @param environmentId - The environment ID\n * @param userId - The user ID\n * @param noCache - Whether to skip the cache\n * @returns The person state\n * @throws NetworkError\n */\nexport const fetchPersonState = async (\n  { apiHost, environmentId, userId }: TJsPersonSyncParams,\n  noCache: boolean = false\n): Promise<TJsPersonState> => {\n  let fetchOptions: RequestInit = {};\n\n  if (noCache || getIsDebug()) {\n    fetchOptions.cache = \"no-cache\";\n    logger.debug(\"No cache option set for sync\");\n  }\n\n  const url = `${apiHost}/api/v1/client/${environmentId}/identify/people/${userId}`;\n\n  const response = await fetch(url, fetchOptions);\n\n  if (!response.ok) {\n    const jsonRes = await response.json();\n\n    const error = err({\n      code: \"network_error\",\n      status: response.status,\n      message: \"Error syncing with backend\",\n      url: new URL(url),\n      responseMessage: jsonRes.message,\n    });\n\n    throw error;\n  }\n\n  const data = await response.json();\n  const { data: state } = data;\n\n  console.log(\"Person state fetched\", state);\n\n  const defaultPersonState: TJsPersonState = {\n    expiresAt: new Date(new Date().getTime() + 1000 * 60 * 30), // 30 minutes\n    data: {\n      userId,\n      segments: [],\n      displays: [],\n      responses: [],\n      attributes: {},\n      lastDisplayAt: null,\n    },\n  };\n\n  if (!Object.keys(state).length) {\n    return defaultPersonState;\n  }\n\n  return {\n    data: { ...(state as TJsPersonState[\"data\"]) },\n    expiresAt: new Date(new Date().getTime() + 1000 * 60 * 30), // 30 minutes\n  };\n};\n\n/**\n * Add a listener to check if the person state has expired with a certain interval\n * @param config - The configuration for the SDK\n */\nexport const addPersonStateExpiryCheckListener = (): void => {\n  const updateInterval = 1000 * 60; // every 60 seconds\n\n  if (typeof window !== \"undefined\" && personStateSyncIntervalId === null) {\n    personStateSyncIntervalId = window.setInterval(async () => {\n      const userId = config.get().personState.data.userId;\n\n      if (!userId) {\n        return;\n      }\n\n      // extend the personState validity by 30 minutes:\n      config.update({\n        ...config.get(),\n        personState: {\n          ...config.get().personState,\n          expiresAt: new Date(new Date().getTime() + 1000 * 60 * 30), // 30 minutes\n        },\n      });\n    }, updateInterval);\n  }\n};\n\n/**\n * Clear the person state expiry check listener\n */\nexport const clearPersonStateExpiryCheckListener = (): void => {\n  if (personStateSyncIntervalId) {\n    clearInterval(personStateSyncIntervalId);\n    personStateSyncIntervalId = null;\n  }\n};\n","import { FormbricksAPI } from \"@formbricks/api\";\nimport { TAttributes } from \"@formbricks/types/attributes\";\nimport { Config } from \"./config\";\nimport { MissingPersonError, NetworkError, Result, err, ok, okVoid } from \"./errors\";\nimport { Logger } from \"./logger\";\nimport { fetchPersonState } from \"./personState\";\nimport { filterSurveys } from \"./utils\";\n\nconst config = Config.getInstance();\nconst logger = Logger.getInstance();\n\nexport const updateAttribute = async (\n  key: string,\n  value: string | number\n): Promise<\n  Result<\n    {\n      changed: boolean;\n      message: string;\n    },\n    Error | NetworkError\n  >\n> => {\n  const { apiHost, environmentId } = config.get();\n  const userId = config.get().personState.data.userId;\n\n  if (!userId) {\n    return err({\n      code: \"network_error\",\n      status: 500,\n      message: \"Missing userId\",\n      url: `${apiHost}/api/v1/client/${environmentId}/people/${userId}/attributes`,\n      responseMessage: \"Missing userId\",\n    });\n  }\n\n  const api = new FormbricksAPI({\n    apiHost,\n    environmentId,\n  });\n\n  const res = await api.client.attribute.update({ userId, attributes: { [key]: value } });\n\n  if (!res.ok) {\n    // @ts-expect-error\n    if (res.error.details?.ignore) {\n      logger.error(res.error.message ?? `Error updating person with userId ${userId}`);\n      return {\n        ok: true,\n        value: {\n          changed: false,\n          message: res.error.message,\n        },\n      };\n    }\n    return err({\n      code: \"network_error\",\n      // @ts-expect-error\n      status: res.error.status ?? 500,\n      message: res.error.message ?? `Error updating person with userId ${userId}`,\n      url: `${config.get().apiHost}/api/v1/client/${environmentId}/people/${userId}/attributes`,\n      responseMessage: res.error.message,\n    });\n  }\n\n  if (res.data.changed) {\n    logger.debug(\"Attribute updated in Formbricks\");\n    return {\n      ok: true,\n      value: {\n        changed: true,\n        message: \"Attribute updated in Formbricks\",\n      },\n    };\n  }\n\n  return {\n    ok: true,\n    value: {\n      changed: false,\n      message: \"Attribute not updated in Formbricks\",\n    },\n  };\n};\n\nexport const updateAttributes = async (\n  apiHost: string,\n  environmentId: string,\n  userId: string,\n  attributes: TAttributes\n): Promise<Result<TAttributes, NetworkError>> => {\n  // clean attributes and remove existing attributes if config already exists\n  const updatedAttributes = { ...attributes };\n\n  try {\n    const existingAttributes = config.get().personState.data.attributes;\n    if (existingAttributes) {\n      for (const [key, value] of Object.entries(existingAttributes)) {\n        if (updatedAttributes[key] === value) {\n          delete updatedAttributes[key];\n        }\n      }\n    }\n  } catch (e) {\n    logger.debug(\"config not set; sending all attributes to backend\");\n  }\n\n  // send to backend if updatedAttributes is not empty\n  if (Object.keys(updatedAttributes).length === 0) {\n    logger.debug(\"No attributes to update. Skipping update.\");\n    return ok(updatedAttributes);\n  }\n\n  logger.debug(\"Updating attributes: \" + JSON.stringify(updatedAttributes));\n\n  const api = new FormbricksAPI({\n    apiHost,\n    environmentId,\n  });\n\n  const res = await api.client.attribute.update({ userId, attributes: updatedAttributes });\n\n  if (res.ok) {\n    return ok(updatedAttributes);\n  } else {\n    // @ts-expect-error\n    if (res.error.details?.ignore) {\n      logger.error(res.error.message ?? `Error updating person with userId ${userId}`);\n      return ok(updatedAttributes);\n    }\n\n    return err({\n      code: \"network_error\",\n      status: 500,\n      message: `Error updating person with userId ${userId}`,\n      url: `${apiHost}/api/v1/client/${environmentId}/people/${userId}/attributes`,\n      responseMessage: res.error.message,\n    });\n  }\n};\n\nexport const isExistingAttribute = (key: string, value: string): boolean => {\n  if (config.get().personState.data.attributes[key] === value) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const setAttributeInApp = async (\n  key: string,\n  value: any\n): Promise<Result<void, NetworkError | MissingPersonError>> => {\n  if (key === \"userId\") {\n    logger.error(\"Setting userId is no longer supported. Please set the userId in the init call instead.\");\n    return okVoid();\n  }\n\n  const userId = config.get().personState.data.userId;\n\n  logger.debug(\"Setting attribute: \" + key + \" to value: \" + value);\n  // check if attribute already exists with this value\n  if (isExistingAttribute(key, value.toString())) {\n    logger.debug(\"Attribute already set to this value. Skipping update.\");\n    return okVoid();\n  }\n\n  if (!userId) {\n    logger.error(\n      \"UserId not provided, please provide a userId in the init method before setting attributes.\"\n    );\n    return okVoid();\n  }\n\n  const result = await updateAttribute(key, value.toString());\n\n  if (result.ok) {\n    if (result.value.changed) {\n      const personState = await fetchPersonState(\n        {\n          apiHost: config.get().apiHost,\n          environmentId: config.get().environmentId,\n          userId,\n        },\n        true\n      );\n\n      const filteredSurveys = filterSurveys(config.get().environmentState, personState);\n\n      config.update({\n        ...config.get(),\n        personState,\n        filteredSurveys,\n      });\n    }\n\n    return okVoid();\n  }\n\n  return err(result.error as NetworkError);\n};\n","export type Result<T, E = Error> = { ok: true; data: T } | { ok: false; error: E };\n\nexport const ok = <T, E>(data: T): Result<T, E> => ({ ok: true, data });\n\nexport const okVoid = <E>(): Result<void, E> => ({ ok: true, data: undefined });\n\nexport const err = <E = Error>(error: E): Result<never, E> => ({\n  ok: false,\n  error,\n});\n\n// Applies the given function `fn` to the data property of the input `result` object\n// and returns a new `Result` object with the transformed data property.\n//\n// T - The type of the input data.\n// R - The type of the output data.\n//\n// fn - The function to apply to the data property of the input `result` object.\n// Returns a new function that takes in a `Result<T>` object and returns a new `Result<R>` object.\n//\n//\n// Example:\n// const divideByTwo = (num: number): Result<number> => {\n//   if (num === 0) {\n//     return { ok: false, error: \"Cannot divide zero\" };\n//   }\n//\n//   return { ok: true, data: num / 2 };\n// }\n//\n// const wrappedDivideByTwo = wrap(divideByTwo);\n//\n// const result1: Result<number> = { ok: true, data: 10 };\n// const result2: Result<number> = { ok: false, error: \"Invalid input\" };\n// const result3: Result<number> = { ok: true, data: 0 };\n//\n// console.log(wrappedDivideByTwo(result1)); // { ok: true, data: 5 }\n// console.log(wrappedDivideByTwo(result2)); // { ok: false, error: \"Invalid input\" }\n// console.log(wrappedDivideByTwo(result3)); // { ok: false, error: \"Cannot divide zero\" }\nexport const wrap =\n  <T, R>(fn: (value: T) => R) =>\n  (result: Result<T>): Result<R> =>\n    result.ok ? { ok: true, data: fn(result.data) } : result;\n\n// Matches the given `result` object against its `ok` property and invokes the `onSuccess` function\n// if `ok` is `true`, or the `onError` function if `ok` is `false`. Returns the result of the invoked function.\n//\n// TSuccess - Type of the success value.\n// TError - Type of the error value.\n// TReturn - Type of the return value.\n//\n// result - The `Result` object to match against.\n// onSuccess - The function to invoke if `result.ok` is `true`.\n// onError - The function to invoke if `result.ok` is `false`.\n//\n// Returns the result of the invoked function.\n//\n// Example:\n// const test = (): Result<string, Error> => {\n//  return err(new Error(\"error happened\"));\n// }\n//\n// const result = test();\n//\n// match(result, (value) => {\n//  console.log(value); // never run with this example\n// }, (error) => {\n//  console.log(error); // Error: error happened\n// });\nexport const match = <TSuccess, TError, TReturn>(\n  result: Result<TSuccess, TError>,\n  onSuccess: (value: TSuccess) => TReturn,\n  onError: (error: TError) => TReturn\n): TReturn => (result.ok ? onSuccess(result.data) : onError(result.error));\n\n// Wraps a function `fn` that may throw an error into a new function that returns a `Result` object.\n// If the wrapped function throws an error, the returned `Result` object will have an `ok` property of `false`\n// and an `error` property containing the thrown error. Otherwise, the returned `Result` object will have an\n// `ok` property of `true` and a `data` property containing the result of the wrapped function.\n//\n// T - The type of the result value.\n// A - An array of the types of the arguments expected by the wrapped function.\n//\n// fn - The function to wrap.\n// Returns a new function that returns a `Result` object.\n//\n// Example:\n// function divideByTwo(num: number): number {\n//   if (num === 0) {\n//     throw new Error(\"Cannot divide zero\");\n//   }\n//   return num / 2;\n// }\n//\n// const wrappedDivideByTwo = wrapThrows(divideByTwo);\n//\n// const result1: Result<number> = wrappedDivideByTwo(10); // { ok: true, data: 5 }\n// const result2: Result<number> = wrappedDivideByTwo(0); // { ok: false, error: Error(\"Cannot divide zero\") }\nexport const wrapThrows =\n  <T, A extends unknown[]>(fn: (...args: A) => T): ((...args: A) => Result<T>) =>\n  (...args: A): Result<T> => {\n    try {\n      return {\n        ok: true,\n        data: fn(...args),\n      };\n    } catch (error) {\n      return {\n        ok: false,\n        error: error as Error,\n      };\n    }\n  };\n\n// Wraps an asynchronous function `fn` that may throw an error into a new function that returns a `Result` object.\n// If the wrapped function throws an error, the returned `Result` object will have an `ok` property of `false`\n// and an `error` property containing the thrown error. Otherwise, the returned `Result` object will have an\n// `ok` property of `true` and a `data` property containing the result of the wrapped function.\n//\n// T - The type of the result value.\n// A - An array of the types of the arguments expected by the wrapped function.\n//\n// fn - The asynchronous function to wrap.\n// Returns a new function that returns a `Result` object.\n//\n// Example:\n// async function fetchData(url: string): Promise<string> {\n//   const response = await fetch(url);\n//   if (!response.ok) {\n//     throw new Error(\"Network response was not ok\");\n//   }\n//   return response.text();\n// }\n//\n// const wrappedFetchData = wrapThrowsAsync(fetchData);\n//\n// const result1: Result<string> = await wrappedFetchData(\"https://example.com\"); // { ok: true, data: \"...\" }\n// const result2: Result<string> = await wrappedFetchData(\"https://bad-url.com\"); // { ok: false, error: Error(\"Network response was not ok\") }\nexport const wrapThrowsAsync =\n  <T, A extends unknown[]>(fn: (...args: A) => Promise<T>) =>\n  async (...args: A): Promise<Result<T>> => {\n    try {\n      return {\n        ok: true,\n        data: await fn(...args),\n      };\n    } catch (error) {\n      return {\n        ok: false,\n        error: error as Error,\n      };\n    }\n  };\n","// shared functions for environment and person state(s)\nimport { TJsEnvironmentState, TJsEnvironmentSyncParams } from \"@formbricks/types/js\";\nimport { Config } from \"./config\";\nimport { err } from \"./errors\";\nimport { Logger } from \"./logger\";\nimport { filterSurveys, getIsDebug } from \"./utils\";\n\nconst config = Config.getInstance();\nconst logger = Logger.getInstance();\nlet environmentStateSyncIntervalId: number | null = null;\n\n/**\n * Fetch the environment state from the backend\n * @param apiHost - The API host\n * @param environmentId - The environment ID\n * @param noCache - Whether to skip the cache\n * @returns The environment state\n * @throws NetworkError\n */\nexport const fetchEnvironmentState = async (\n  { apiHost, environmentId }: TJsEnvironmentSyncParams,\n  noCache: boolean = false\n): Promise<TJsEnvironmentState> => {\n  let fetchOptions: RequestInit = {};\n\n  if (noCache || getIsDebug()) {\n    fetchOptions.cache = \"no-cache\";\n    logger.debug(\"No cache option set for sync\");\n  }\n\n  const url = `${apiHost}/api/v1/client/${environmentId}/environment`;\n\n  const response = await fetch(url, fetchOptions);\n\n  if (!response.ok) {\n    const jsonRes = await response.json();\n\n    const error = err({\n      code: \"network_error\",\n      status: response.status,\n      message: \"Error syncing with backend\",\n      url: new URL(url),\n      responseMessage: jsonRes.message,\n    });\n\n    throw error;\n  }\n\n  const data = await response.json();\n  const { data: state } = data;\n\n  return {\n    data: { ...(state as TJsEnvironmentState[\"data\"]) },\n    expiresAt: new Date(new Date().getTime() + 1000 * 60 * 30), // 30 minutes\n  };\n};\n\nexport const addEnvironmentStateExpiryCheckListener = (): void => {\n  let updateInterval = 1000 * 60; // every minute\n  if (typeof window !== \"undefined\" && environmentStateSyncIntervalId === null) {\n    environmentStateSyncIntervalId = window.setInterval(async () => {\n      const expiresAt = config.get().environmentState.expiresAt;\n\n      try {\n        // check if the environmentState has not expired yet\n        if (expiresAt && new Date(expiresAt) >= new Date()) {\n          return;\n        }\n\n        logger.debug(\"Environment State has expired. Starting sync.\");\n\n        const personState = config.get().personState;\n        const environmentState = await fetchEnvironmentState(\n          {\n            apiHost: config.get().apiHost,\n            environmentId: config.get().environmentId,\n          },\n          true\n        );\n\n        const filteredSurveys = filterSurveys(environmentState, personState);\n\n        config.update({\n          ...config.get(),\n          environmentState,\n          filteredSurveys,\n        });\n      } catch (e) {\n        console.error(`Error during expiry check: ${e}`);\n        logger.debug(\"Extending config and try again later.\");\n        const existingConfig = config.get();\n        config.update(existingConfig);\n      }\n    }, updateInterval);\n  }\n};\n\nexport const clearEnvironmentStateExpiryCheckListener = (): void => {\n  if (environmentStateSyncIntervalId) {\n    clearInterval(environmentStateSyncIntervalId);\n    environmentStateSyncIntervalId = null;\n  }\n};\n","import type { TActionClass } from \"@formbricks/types/action-classes\";\nimport { trackNoCodeAction } from \"./actions\";\nimport { Config } from \"./config\";\nimport { ErrorHandler, NetworkError, Result, err, match, okVoid } from \"./errors\";\nimport { Logger } from \"./logger\";\nimport { evaluateNoCodeConfigClick, handleUrlFilters } from \"./utils\";\n\nconst appConfig = Config.getInstance();\nconst logger = Logger.getInstance();\nconst errorHandler = ErrorHandler.getInstance();\n\n// Event types for various listeners\nconst events = [\"hashchange\", \"popstate\", \"pushstate\", \"replacestate\", \"load\"];\n\n// Page URL Event Handlers\nlet arePageUrlEventListenersAdded = false;\n\nexport const checkPageUrl = async (): Promise<Result<void, NetworkError>> => {\n  logger.debug(`Checking page url: ${window.location.href}`);\n  const actionClasses = appConfig.get().environmentState.data.actionClasses;\n\n  const noCodePageViewActionClasses = actionClasses.filter(\n    (action) => action.type === \"noCode\" && action.noCodeConfig?.type === \"pageView\"\n  );\n\n  for (const event of noCodePageViewActionClasses) {\n    const urlFilters = event.noCodeConfig?.urlFilters ?? [];\n    const isValidUrl = handleUrlFilters(urlFilters);\n\n    if (!isValidUrl) continue;\n\n    const trackResult = await trackNoCodeAction(event.name);\n    if (trackResult.ok !== true) return err(trackResult.error);\n  }\n\n  return okVoid();\n};\n\nconst checkPageUrlWrapper = () => checkPageUrl();\n\nexport const addPageUrlEventListeners = (): void => {\n  if (typeof window === \"undefined\" || arePageUrlEventListenersAdded) return;\n  events.forEach((event) => window.addEventListener(event, checkPageUrlWrapper));\n  arePageUrlEventListenersAdded = true;\n};\n\nexport const removePageUrlEventListeners = (): void => {\n  if (typeof window === \"undefined\" || !arePageUrlEventListenersAdded) return;\n  events.forEach((event) => window.removeEventListener(event, checkPageUrlWrapper));\n  arePageUrlEventListenersAdded = false;\n};\n\n// Click Event Handlers\nlet isClickEventListenerAdded = false;\n\nconst checkClickMatch = (event: MouseEvent) => {\n  const { environmentState } = appConfig.get();\n  if (!environmentState) return;\n\n  const { actionClasses = [] } = environmentState.data;\n\n  const noCodeClickActionClasses = actionClasses.filter(\n    (action) => action.type === \"noCode\" && action.noCodeConfig?.type === \"click\"\n  );\n\n  const targetElement = event.target as HTMLElement;\n\n  noCodeClickActionClasses.forEach((action: TActionClass) => {\n    if (evaluateNoCodeConfigClick(targetElement, action)) {\n      trackNoCodeAction(action.name).then((res) => {\n        match(\n          res,\n          (_value: unknown) => {},\n          (err: any) => errorHandler.handle(err)\n        );\n      });\n    }\n  });\n};\n\nconst checkClickMatchWrapper = (e: MouseEvent) => checkClickMatch(e);\n\nexport const addClickEventListener = (): void => {\n  if (typeof window === \"undefined\" || isClickEventListenerAdded) return;\n  document.addEventListener(\"click\", checkClickMatchWrapper);\n  isClickEventListenerAdded = true;\n};\n\nexport const removeClickEventListener = (): void => {\n  if (!isClickEventListenerAdded) return;\n  document.removeEventListener(\"click\", checkClickMatchWrapper);\n  isClickEventListenerAdded = false;\n};\n\n// Exit Intent Handlers\nlet isExitIntentListenerAdded = false;\n\nconst checkExitIntent = async (e: MouseEvent) => {\n  const { environmentState } = appConfig.get();\n  const { actionClasses = [] } = environmentState.data ?? {};\n\n  const noCodeExitIntentActionClasses = actionClasses.filter(\n    (action) => action.type === \"noCode\" && action.noCodeConfig?.type === \"exitIntent\"\n  );\n\n  if (e.clientY <= 0 && noCodeExitIntentActionClasses.length > 0) {\n    for (const event of noCodeExitIntentActionClasses) {\n      const urlFilters = event.noCodeConfig?.urlFilters ?? [];\n      const isValidUrl = handleUrlFilters(urlFilters);\n\n      if (!isValidUrl) continue;\n\n      const trackResult = await trackNoCodeAction(event.name);\n      if (trackResult.ok !== true) return err(trackResult.error);\n    }\n  }\n};\n\nconst checkExitIntentWrapper = (e: MouseEvent) => checkExitIntent(e);\n\nexport const addExitIntentListener = (): void => {\n  if (typeof document !== \"undefined\" && !isExitIntentListenerAdded) {\n    document.querySelector(\"body\")!.addEventListener(\"mouseleave\", checkExitIntentWrapper);\n    isExitIntentListenerAdded = true;\n  }\n};\n\nexport const removeExitIntentListener = (): void => {\n  if (isExitIntentListenerAdded) {\n    document.removeEventListener(\"mouseleave\", checkExitIntentWrapper);\n    isExitIntentListenerAdded = false;\n  }\n};\n\n// Scroll Depth Handlers\nlet scrollDepthListenerAdded = false;\nlet scrollDepthTriggered = false;\n\nconst checkScrollDepth = async () => {\n  const scrollPosition = window.scrollY;\n  const windowSize = window.innerHeight;\n  const bodyHeight = document.documentElement.scrollHeight;\n\n  if (scrollPosition === 0) {\n    scrollDepthTriggered = false;\n  }\n\n  if (!scrollDepthTriggered && scrollPosition / (bodyHeight - windowSize) >= 0.5) {\n    scrollDepthTriggered = true;\n\n    const { environmentState } = appConfig.get();\n    const { actionClasses = [] } = environmentState.data ?? {};\n\n    const noCodefiftyPercentScrollActionClasses = actionClasses.filter(\n      (action) => action.type === \"noCode\" && action.noCodeConfig?.type === \"fiftyPercentScroll\"\n    );\n\n    for (const event of noCodefiftyPercentScrollActionClasses) {\n      const urlFilters = event.noCodeConfig?.urlFilters ?? [];\n      const isValidUrl = handleUrlFilters(urlFilters);\n\n      if (!isValidUrl) continue;\n\n      const trackResult = await trackNoCodeAction(event.name);\n      if (trackResult.ok !== true) return err(trackResult.error);\n    }\n  }\n\n  return okVoid();\n};\n\nconst checkScrollDepthWrapper = () => checkScrollDepth();\n\nexport const addScrollDepthListener = (): void => {\n  if (typeof window !== \"undefined\" && !scrollDepthListenerAdded) {\n    if (document.readyState === \"complete\") {\n      window.addEventListener(\"scroll\", checkScrollDepthWrapper);\n    } else {\n      window.addEventListener(\"load\", () => {\n        window.addEventListener(\"scroll\", checkScrollDepthWrapper);\n      });\n    }\n    scrollDepthListenerAdded = true;\n  }\n};\n\nexport const removeScrollDepthListener = (): void => {\n  if (scrollDepthListenerAdded) {\n    window.removeEventListener(\"scroll\", checkScrollDepthWrapper);\n    scrollDepthListenerAdded = false;\n  }\n};\n","import {\n  addEnvironmentStateExpiryCheckListener,\n  clearEnvironmentStateExpiryCheckListener,\n} from \"./environmentState\";\nimport {\n  addClickEventListener,\n  addExitIntentListener,\n  addPageUrlEventListeners,\n  addScrollDepthListener,\n  removeClickEventListener,\n  removeExitIntentListener,\n  removePageUrlEventListeners,\n  removeScrollDepthListener,\n} from \"./noCodeActions\";\nimport { addPersonStateExpiryCheckListener, clearPersonStateExpiryCheckListener } from \"./personState\";\n\nlet areRemoveEventListenersAdded = false;\n\nexport const addEventListeners = (): void => {\n  addEnvironmentStateExpiryCheckListener();\n  addPersonStateExpiryCheckListener();\n  addPageUrlEventListeners();\n  addClickEventListener();\n  addExitIntentListener();\n  addScrollDepthListener();\n};\n\nexport const addCleanupEventListeners = (): void => {\n  if (areRemoveEventListenersAdded) return;\n  window.addEventListener(\"beforeunload\", () => {\n    clearEnvironmentStateExpiryCheckListener();\n    clearPersonStateExpiryCheckListener();\n    removePageUrlEventListeners();\n    removeClickEventListener();\n    removeExitIntentListener();\n    removeScrollDepthListener();\n  });\n  areRemoveEventListenersAdded = true;\n};\n\nexport const removeCleanupEventListeners = (): void => {\n  if (!areRemoveEventListenersAdded) return;\n  window.removeEventListener(\"beforeunload\", () => {\n    clearEnvironmentStateExpiryCheckListener();\n    clearPersonStateExpiryCheckListener();\n    removePageUrlEventListeners();\n    removeClickEventListener();\n    removeExitIntentListener();\n    removeScrollDepthListener();\n  });\n  areRemoveEventListenersAdded = false;\n};\n\nexport const removeAllEventListeners = (): void => {\n  clearEnvironmentStateExpiryCheckListener();\n  clearPersonStateExpiryCheckListener();\n  removePageUrlEventListeners();\n  removeClickEventListener();\n  removeExitIntentListener();\n  removeScrollDepthListener();\n  removeCleanupEventListeners();\n};\n","import { TAttributes } from \"@formbricks/types/attributes\";\nimport { type TJsConfig, type TJsConfigInput } from \"@formbricks/types/js\";\nimport { trackNoCodeAction } from \"./actions\";\nimport { updateAttributes } from \"./attributes\";\nimport { Config } from \"./config\";\nimport {\n  JS_LOCAL_STORAGE_KEY,\n  LEGACY_JS_APP_LOCAL_STORAGE_KEY,\n  LEGACY_JS_WEBSITE_LOCAL_STORAGE_KEY,\n} from \"./constants\";\nimport { fetchEnvironmentState } from \"./environmentState\";\nimport {\n  ErrorHandler,\n  MissingFieldError,\n  MissingPersonError,\n  NetworkError,\n  NotInitializedError,\n  Result,\n  err,\n  okVoid,\n  wrapThrows,\n} from \"./errors\";\nimport { addCleanupEventListeners, addEventListeners, removeAllEventListeners } from \"./eventListeners\";\nimport { Logger } from \"./logger\";\nimport { checkPageUrl } from \"./noCodeActions\";\nimport { DEFAULT_PERSON_STATE_NO_USER_ID, fetchPersonState } from \"./personState\";\nimport { filterSurveys, getIsDebug } from \"./utils\";\nimport { addWidgetContainer, removeWidgetContainer, setIsSurveyRunning } from \"./widget\";\n\nconst logger = Logger.getInstance();\n\nlet isInitialized = false;\n\nexport const setIsInitialized = (value: boolean) => {\n  isInitialized = value;\n};\n\nconst migrateLocalStorage = (): { changed: boolean; newState?: TJsConfig } => {\n  const oldWebsiteConfig = localStorage.getItem(LEGACY_JS_WEBSITE_LOCAL_STORAGE_KEY);\n  const oldAppConfig = localStorage.getItem(LEGACY_JS_APP_LOCAL_STORAGE_KEY);\n\n  if (oldWebsiteConfig) {\n    localStorage.removeItem(LEGACY_JS_WEBSITE_LOCAL_STORAGE_KEY);\n    const parsedOldConfig = JSON.parse(oldWebsiteConfig) as TJsConfig;\n\n    if (\n      parsedOldConfig.environmentId &&\n      parsedOldConfig.apiHost &&\n      parsedOldConfig.environmentState &&\n      parsedOldConfig.personState &&\n      parsedOldConfig.filteredSurveys\n    ) {\n      const newLocalStorageConfig = { ...parsedOldConfig };\n\n      return {\n        changed: true,\n        newState: newLocalStorageConfig,\n      };\n    }\n  }\n\n  if (oldAppConfig) {\n    localStorage.removeItem(LEGACY_JS_APP_LOCAL_STORAGE_KEY);\n    const parsedOldConfig = JSON.parse(oldAppConfig) as TJsConfig;\n\n    if (\n      parsedOldConfig.environmentId &&\n      parsedOldConfig.apiHost &&\n      parsedOldConfig.environmentState &&\n      parsedOldConfig.personState &&\n      parsedOldConfig.filteredSurveys\n    ) {\n      return {\n        changed: true,\n      };\n    }\n  }\n\n  return {\n    changed: false,\n  };\n};\n\nexport const initialize = async (\n  configInput: TJsConfigInput\n): Promise<Result<void, MissingFieldError | NetworkError | MissingPersonError>> => {\n  const isDebug = getIsDebug();\n  if (isDebug) {\n    logger.configure({ logLevel: \"debug\" });\n  }\n  let config = Config.getInstance();\n\n  const { changed, newState } = migrateLocalStorage();\n\n  if (changed) {\n    config.resetConfig();\n    config = Config.getInstance();\n\n    // If the js sdk is being used for non identified users, and we have a new state to update to after migrating, we update the state\n    // otherwise, we just sync again!\n    if (!configInput.userId && newState) {\n      config.update(newState);\n    }\n  }\n\n  if (isInitialized) {\n    logger.debug(\"Already initialized, skipping initialization.\");\n    return okVoid();\n  }\n\n  let existingConfig: TJsConfig | undefined;\n  try {\n    existingConfig = config.get();\n    logger.debug(\"Found existing configuration.\");\n  } catch (e) {\n    logger.debug(\"No existing configuration found.\");\n  }\n\n  // formbricks is in error state, skip initialization\n  if (existingConfig?.status?.value === \"error\") {\n    if (isDebug) {\n      logger.debug(\n        \"Formbricks is in error state, but debug mode is active. Resetting config and continuing.\"\n      );\n      config.resetConfig();\n      return okVoid();\n    }\n\n    logger.debug(\"Formbricks was set to an error state.\");\n\n    const expiresAt = existingConfig?.status?.expiresAt;\n\n    if (expiresAt && new Date(expiresAt) > new Date()) {\n      logger.debug(\"Error state is not expired, skipping initialization\");\n      return okVoid();\n    } else {\n      logger.debug(\"Error state is expired. Continue with initialization.\");\n    }\n  }\n\n  ErrorHandler.getInstance().printStatus();\n\n  logger.debug(\"Start initialize\");\n\n  if (!configInput.environmentId) {\n    logger.debug(\"No environmentId provided\");\n    return err({\n      code: \"missing_field\",\n      field: \"environmentId\",\n    });\n  }\n\n  if (!configInput.apiHost) {\n    logger.debug(\"No apiHost provided\");\n\n    return err({\n      code: \"missing_field\",\n      field: \"apiHost\",\n    });\n  }\n\n  logger.debug(\"Adding widget container to DOM\");\n  addWidgetContainer();\n\n  let updatedAttributes: TAttributes | null = null;\n  if (configInput.attributes) {\n    if (configInput.userId) {\n      const res = await updateAttributes(\n        configInput.apiHost,\n        configInput.environmentId,\n        configInput.userId,\n        configInput.attributes\n      );\n      if (res.ok !== true) {\n        return err(res.error);\n      }\n      updatedAttributes = res.value;\n    } else {\n      updatedAttributes = { ...configInput.attributes };\n    }\n  }\n\n  if (\n    existingConfig &&\n    existingConfig.environmentState &&\n    existingConfig.environmentId === configInput.environmentId &&\n    existingConfig.apiHost === configInput.apiHost\n  ) {\n    logger.debug(\"Configuration fits init parameters.\");\n    let isEnvironmentStateExpired = false;\n    let isPersonStateExpired = false;\n\n    if (new Date(existingConfig.environmentState.expiresAt) < new Date()) {\n      logger.debug(\"Environment state expired. Syncing.\");\n      isEnvironmentStateExpired = true;\n    }\n\n    // if the config has a userId and the person state has expired, we need to sync the person state\n    if (\n      configInput.userId &&\n      existingConfig.personState.expiresAt &&\n      new Date(existingConfig.personState.expiresAt) < new Date()\n    ) {\n      logger.debug(\"Person state expired. Syncing.\");\n      isPersonStateExpired = true;\n    }\n\n    try {\n      // fetch the environment state (if expired)\n      const environmentState = isEnvironmentStateExpired\n        ? await fetchEnvironmentState({\n            apiHost: configInput.apiHost,\n            environmentId: configInput.environmentId,\n          })\n        : existingConfig.environmentState;\n\n      // fetch the person state (if expired)\n\n      let { personState } = existingConfig;\n\n      if (isPersonStateExpired) {\n        if (configInput.userId) {\n          personState = await fetchPersonState({\n            apiHost: configInput.apiHost,\n            environmentId: configInput.environmentId,\n            userId: configInput.userId,\n          });\n        } else {\n          personState = DEFAULT_PERSON_STATE_NO_USER_ID;\n        }\n      }\n\n      // filter the environment state wrt the person state\n      const filteredSurveys = filterSurveys(environmentState, personState);\n\n      // update the appConfig with the new filtered surveys\n      config.update({\n        ...existingConfig,\n        environmentState,\n        personState,\n        filteredSurveys,\n      });\n\n      const surveyNames = filteredSurveys.map((s) => s.name);\n      logger.debug(\"Fetched \" + surveyNames.length + \" surveys during sync: \" + surveyNames.join(\", \"));\n    } catch (e) {\n      putFormbricksInErrorState(config);\n    }\n  } else {\n    logger.debug(\n      \"No valid configuration found or it has been expired. Resetting config and creating new one.\"\n    );\n    config.resetConfig();\n    logger.debug(\"Syncing.\");\n\n    try {\n      const environmentState = await fetchEnvironmentState(\n        {\n          apiHost: configInput.apiHost,\n          environmentId: configInput.environmentId,\n        },\n        false\n      );\n      const personState = configInput.userId\n        ? await fetchPersonState(\n            {\n              apiHost: configInput.apiHost,\n              environmentId: configInput.environmentId,\n              userId: configInput.userId,\n            },\n            false\n          )\n        : DEFAULT_PERSON_STATE_NO_USER_ID;\n\n      const filteredSurveys = filterSurveys(environmentState, personState);\n\n      config.update({\n        apiHost: configInput.apiHost,\n        environmentId: configInput.environmentId,\n        personState,\n        environmentState,\n        filteredSurveys,\n      });\n    } catch (e) {\n      handleErrorOnFirstInit();\n    }\n\n    // and track the new session event\n    await trackNoCodeAction(\"New Session\");\n  }\n\n  // update attributes in config\n  if (updatedAttributes && Object.keys(updatedAttributes).length > 0) {\n    config.update({\n      ...config.get(),\n      personState: {\n        ...config.get().personState,\n        data: {\n          ...config.get().personState.data,\n          attributes: {\n            ...config.get().personState.data.attributes,\n            ...updatedAttributes,\n          },\n        },\n      },\n    });\n  }\n\n  logger.debug(\"Adding event listeners\");\n  addEventListeners();\n  addCleanupEventListeners();\n\n  setIsInitialized(true);\n  logger.debug(\"Initialized\");\n\n  // check page url if initialized after page load\n\n  checkPageUrl();\n  return okVoid();\n};\n\nexport const handleErrorOnFirstInit = () => {\n  if (getIsDebug()) {\n    logger.debug(\"Not putting formbricks in error state because debug mode is active (no error state)\");\n    return;\n  }\n\n  // put formbricks in error state (by creating a new config) and throw error\n  const initialErrorConfig: Partial<TJsConfig> = {\n    status: {\n      value: \"error\",\n      expiresAt: new Date(new Date().getTime() + 10 * 60000), // 10 minutes in the future\n    },\n  };\n\n  // can't use config.update here because the config is not yet initialized\n  wrapThrows(() => localStorage.setItem(JS_LOCAL_STORAGE_KEY, JSON.stringify(initialErrorConfig)))();\n  throw new Error(\"Could not initialize formbricks\");\n};\n\nexport const checkInitialized = (): Result<void, NotInitializedError> => {\n  logger.debug(\"Check if initialized\");\n  if (!isInitialized || !ErrorHandler.initialized) {\n    return err({\n      code: \"not_initialized\",\n      message: \"Formbricks not initialized. Call initialize() first.\",\n    });\n  }\n\n  return okVoid();\n};\n\nexport const deinitalize = (): void => {\n  logger.debug(\"Deinitializing\");\n  removeWidgetContainer();\n  setIsSurveyRunning(false);\n  removeAllEventListeners();\n  setIsInitialized(false);\n};\n\nexport const putFormbricksInErrorState = (config: Config): void => {\n  if (getIsDebug()) {\n    logger.debug(\"Not putting formbricks in error state because debug mode is active (no error state)\");\n    return;\n  }\n\n  logger.debug(\"Putting formbricks in error state\");\n  // change formbricks status to error\n  config.update({\n    ...config.get(),\n    status: {\n      value: \"error\",\n      expiresAt: new Date(new Date().getTime() + 10 * 60000), // 10 minutes in the future\n    },\n  });\n  deinitalize();\n};\n","import { Config } from \"./config\";\nimport { NetworkError, Result, err, okVoid } from \"./errors\";\nimport { deinitalize, initialize } from \"./initialize\";\nimport { Logger } from \"./logger\";\nimport { closeSurvey } from \"./widget\";\n\nconst config = Config.getInstance();\nconst logger = Logger.getInstance();\n\nexport const logoutPerson = async (): Promise<void> => {\n  deinitalize();\n  config.resetConfig();\n};\n\nexport const resetPerson = async (): Promise<Result<void, NetworkError>> => {\n  logger.debug(\"Resetting state & getting new state from backend\");\n  closeSurvey();\n\n  const userId = config.get().personState.data.userId;\n\n  const syncParams = {\n    environmentId: config.get().environmentId,\n    apiHost: config.get().apiHost,\n    ...(userId && { userId }),\n    attributes: config.get().personState.data.attributes,\n  };\n  await logoutPerson();\n  try {\n    await initialize(syncParams);\n    return okVoid();\n  } catch (e) {\n    return err(e as NetworkError);\n  }\n};\n","import { TJsConfigInput, TJsTrackProperties } from \"@formbricks/types/js\";\nimport { trackCodeAction } from \"./lib/actions\";\nimport { getApi } from \"./lib/api\";\nimport { setAttributeInApp } from \"./lib/attributes\";\nimport { CommandQueue } from \"./lib/commandQueue\";\nimport { ErrorHandler } from \"./lib/errors\";\nimport { initialize } from \"./lib/initialize\";\nimport { Logger } from \"./lib/logger\";\nimport { checkPageUrl } from \"./lib/noCodeActions\";\nimport { logoutPerson, resetPerson } from \"./lib/person\";\n\nconst logger = Logger.getInstance();\n\nlogger.debug(\"Create command queue\");\nconst queue = new CommandQueue();\n\nconst init = async (initConfig: TJsConfigInput) => {\n  ErrorHandler.init(initConfig.errorHandler);\n  queue.add(false, initialize, initConfig);\n  await queue.wait();\n};\n\nconst setEmail = async (email: string): Promise<void> => {\n  setAttribute(\"email\", email);\n  await queue.wait();\n};\n\nconst setAttribute = async (key: string, value: any): Promise<void> => {\n  queue.add(true, setAttributeInApp, key, value);\n  await queue.wait();\n};\n\nconst logout = async (): Promise<void> => {\n  queue.add(true, logoutPerson);\n  await queue.wait();\n};\n\nconst reset = async (): Promise<void> => {\n  queue.add(true, resetPerson);\n  await queue.wait();\n};\n\nconst track = async (name: string, properties?: TJsTrackProperties): Promise<void> => {\n  queue.add<any>(true, trackCodeAction, name, properties);\n  await queue.wait();\n};\n\nconst registerRouteChange = async (): Promise<void> => {\n  queue.add(true, checkPageUrl);\n  await queue.wait();\n};\n\nconst formbricks = {\n  init,\n  setEmail,\n  setAttribute,\n  track,\n  logout,\n  reset,\n  registerRouteChange,\n  getApi,\n};\n\nexport type TFormbricksApp = typeof formbricks;\nexport default formbricks as TFormbricksApp;\n","import { wrapThrowsAsync } from \"@formbricks/types/error-handlers\";\nimport { ErrorHandler, Result } from \"./errors\";\nimport { checkInitialized } from \"./initialize\";\n\nexport class CommandQueue {\n  private queue: {\n    command: (args: any) => Promise<Result<void, any>> | Result<void, any> | Promise<void>;\n    checkInitialized: boolean;\n    commandArgs: any[any];\n  }[] = [];\n  private running: boolean = false;\n  private resolvePromise: (() => void) | null = null;\n  private commandPromise: Promise<void> | null = null;\n\n  public add<A>(\n    checkInitialized: boolean = true,\n    command: (...args: A[]) => Promise<Result<void, any>> | Result<void, any> | Promise<void>,\n    ...args: A[]\n  ) {\n    this.queue.push({ command, checkInitialized, commandArgs: args });\n\n    if (!this.running) {\n      this.commandPromise = new Promise((resolve) => {\n        this.resolvePromise = resolve;\n        this.run();\n      });\n    }\n  }\n\n  public async wait() {\n    if (this.running) {\n      await this.commandPromise;\n    }\n  }\n\n  private async run() {\n    this.running = true;\n    while (this.queue.length > 0) {\n      const errorHandler = ErrorHandler.getInstance();\n      const currentItem = this.queue.shift();\n\n      if (!currentItem) continue;\n\n      // make sure formbricks is initialized\n      if (currentItem.checkInitialized) {\n        // call different function based on package type\n        const initResult = checkInitialized();\n\n        if (initResult && initResult.ok !== true) {\n          errorHandler.handle(initResult.error);\n          continue;\n        }\n      }\n\n      const executeCommand = async () => {\n        return (await currentItem?.command.apply(null, currentItem?.commandArgs)) as Result<void, any>;\n      };\n\n      const result = await wrapThrowsAsync(executeCommand)();\n\n      if (!result) continue;\n\n      if (result.ok) {\n        if (result.data && !result.data.ok) {\n          errorHandler.handle(result.data.error);\n        }\n      }\n\n      if (result.ok !== true) {\n        errorHandler.handle(result.error);\n      }\n    }\n    this.running = false;\n    if (this.resolvePromise) {\n      this.resolvePromise();\n      this.resolvePromise = null;\n      this.commandPromise = null;\n    }\n  }\n}\n","import { FormbricksAPI } from \"@formbricks/api\";\nimport { Config } from \"./config\";\n\nexport const getApi = (): FormbricksAPI => {\n  const config = Config.getInstance();\n  const { environmentId, apiHost } = config.get();\n\n  if (!environmentId || !apiHost) {\n    throw new Error(\"formbricks.init() must be called before getApi()\");\n  }\n\n  return new FormbricksAPI({\n    apiHost,\n    environmentId,\n  });\n};\n"],"names":["JS_LOCAL_STORAGE_KEY","LEGACY_JS_WEBSITE_LOCAL_STORAGE_KEY","LEGACY_JS_APP_LOCAL_STORAGE_KEY","CONTAINER_ID","_Logger","constructor","__publicField","this","getInstance","instance","configure","config","logLevel","logger","message","level","logMessage","Date","toISOString","toUpperCase","console","error","log","debug","Logger","ok","value","err","wrapThrows","fn","args","_ErrorHandler","errorHandler","handleError","customized","JSON","stringify","init","initialized","printStatus","handle","warn","ErrorHandler","_Config","savedConfig","loadFromLocalStorage","update","newConfig","status","_a","expiresAt","_b","saveToStorage","get","Error","window","localStorage","getItem","parsedConfig","parse","environmentState","async","setItem","resetConfig","removeItem","Config","__defProp","Object","defineProperty","obj","key","enumerable","configurable","writable","__defNormalProp","makeRequest","apiHost","endpoint","method","data","url","URL","body","res","fetch","toString","headers","response","json","errorResponse","code","keys","details","length","AttributeAPI","environmentId","attributeUpdateInput","attributes","String","userId","DisplayAPI","baseUrl","create","displayInput","PeopleAPI","ResponseAPI","responseInput","responseId","finished","ttc","variables","language","buffer","base64Js","b64","lens","getLens","validLen","placeHoldersLen","tmp","i","arr","Arr","_byteLength","curByte","len","revLookup","charCodeAt","uint8","extraBytes","parts","maxChunkLength","len2","push","encodeChunk","lookup","join","Uint8Array","Array","indexOf","start","end","num","output","ieee754","buffer2","offset","isLE","mLen","nBytes","e","m","eLen","eMax","eBias","nBits","d","s","NaN","Infinity","Math","pow","c","rt","abs","isNaN","floor","LN2","exports","base64","ieee754$1","customInspectSymbol","Symbol","Buffer","Buffer2","SlowBuffer","alloc","INSPECT_MAX_BYTES","K_MAX_LENGTH","kMaxLength","GlobalUint8Array","ArrayBuffer","GlobalArrayBuffer","SharedArrayBuffer","GlobalSharedArrayBuffer","globalThis","createBuffer","RangeError","buf","setPrototypeOf","prototype","arg","encodingOrOffset","TypeError","allocUnsafe","from","string","encoding","isEncoding","byteLength2","actual","write","slice","fromString","isView","arrayView","isInstance","copy","fromArrayBuffer","byteOffset","byteLength","fromArrayLike","fromArrayView","valueOf","b","isBuffer","checked","numberIsNaN","type","isArray","fromObject","toPrimitive","assertSize","size","array","mustMatch","arguments","loweredCase","utf8ToBytes","base64ToBytes","toLowerCase","slowToString","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","n","bidirectionalIndexOf","val","dir","arrayIndexOf","call","lastIndexOf","indexSize","arrLength","valLength","read","i2","readUInt16BE","foundIndex","found","j","hexWrite","Number","remaining","strLen","parsed","parseInt","substr","utf8Write","blitBuffer","asciiWrite","str","byteArray","asciiToBytes","base64Write","ucs2Write","units","hi","lo","utf16leToBytes","fromByteArray","min","firstByte","codePoint","bytesPerSequence","secondByte","thirdByte","fourthByte","tempCodePoint","codePoints","MAX_ARGUMENTS_LENGTH","fromCharCode","apply","decodeCodePointsArray","TYPED_ARRAY_SUPPORT","proto","foo","typedArraySupport","poolSize","fill","allocUnsafeSlow","_isBuffer","compare","a","x","y","concat","list","pos","set","swap16","swap32","swap64","toLocaleString","equals","inspect","max","replace","trim","target","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","toJSON","_arr","ret","out","hexSliceLookupTable","bytes","checkOffset","ext","checkInt","wrtBigUInt64LE","checkIntBI","BigInt","wrtBigUInt64BE","checkIEEE754","writeFloat","littleEndian","noAssert","writeDouble","newBuf","subarray","readUintLE","readUIntLE","byteLength3","mul","readUintBE","readUIntBE","readUint8","readUInt8","readUint16LE","readUInt16LE","readUint16BE","readUint32LE","readUInt32LE","readUint32BE","readUInt32BE","readBigUInt64LE","defineBigIntMethod","validateNumber","first","last","boundsError","readBigUInt64BE","readIntLE","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readBigInt64LE","readBigInt64BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUintLE","writeUIntLE","writeUintBE","writeUIntBE","writeUint8","writeUInt8","writeUint16LE","writeUInt16LE","writeUint16BE","writeUInt16BE","writeUint32LE","writeUInt32LE","writeUint32BE","writeUInt32BE","writeBigUInt64LE","writeBigUInt64BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeBigInt64LE","writeBigInt64BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","copyWithin","code2","errors","E","sym","getMessage","Base","name","stack","addNumericalSeparator","range","ERR_OUT_OF_RANGE","checkBounds","ERR_INVALID_ARG_TYPE","ERR_BUFFER_OUT_OF_BOUNDS","input","msg","received","isInteger","INVALID_BASE64_RE","leadSurrogate","toByteArray","split","base64clean","src","dst","alphabet","table","i16","BufferBigIntNotDefined","Buffer$1","StorageAPI","uploadFile","file","allowedFileExtensions","surveyId","payload","fileName","fileType","signedUrl","fileUrl","signingData","presignedFields","updatedFileName","requestHeaders","signature","timestamp","uuid","encodeURIComponent","formData","formDataForS3","FormData","forEach","append","blob","Blob","buffErr","fileBase64String","uploadResponse","signedUrlCopy","err2","uploadJson","errorText","text","Client","options","display","people","attribute","storage","FormbricksAPI","client","delay","ms","Promise","resolve","setTimeout","ResponseQueue","surveyState","api","add","responseUpdate","accumulateResponse","setSurveyState","queue","processQueue","isRequestInProgress","attempts","retryAttempts","sendResponse","shift","onResponseSendingFailed","onResponseSendingFinished","singleUseId","hiddenFields","displayId","updateResponseId","id","updateSurveyState","SurveyState","setSurveyId","clear","copyInstance","responseAcc","updateDisplayId","updateUserId","isResponseFinished","getStyling","product","survey","styling","allowStyleOverwrite","overwriteThemeStyling","diffInDays","date1","date2","diffTime","getTime","handleUrlFilters","urlFilters","windowUrl","location","href","some","filter","pageUrlValue","pageUrlRule","startsWith","endsWith","checkUrlMatch","rule","getDefaultLanguageCode","defaultSurveyLanguage","languages","find","surveyLanguage","default","getIsDebug","search","filterSurveys","personState","surveys","displays","responses","lastDisplayAt","segments","filteredSurveys","displayOption","displayLimit","recontactDays","lastDisplaySurvey","createdAt","segment","isSurveyRunning","setIsError","_","setIsResponseSendingFinished","setIsSurveyRunning","triggerSurvey","action","properties","displayPercentage","random","hiddenFieldsObject","hiddenFieldsConfig","enabled","enabledHiddenFields","fieldIds","hiddenFieldIds","unknownHiddenFields","reduce","acc","logger$9","handleHiddenFields","renderWidget","isMultiLanguageSurvey","languageCode","displayLanguage","availableLanguageCodes","map","selectedLanguage","alias","getLanguageCode","responseQueue","productOverwrites","clickOutside","clickOutsideClose","darkOverlay","placement","isBrandingEnabled","inAppSurveyBranding","formbricksSurveys","loadFormbricksSurveysExternally","renderSurveyModal","getSetIsError","f","getSetIsResponseSendingFinished","onDisplay","existingDisplays","newDisplay","previousConfig","updatedPersonState","onResponse","isNewResponse","meta","newPersonState","onClose","closeSurvey","onFileUpload","params","onRetry","hiddenFieldsRecord","addWidgetContainer","containerElement","document","createElement","appendChild","removeWidgetContainer","getElementById","remove","reject","script","onload","onerror","head","trackAction","aliasName","logger$7","activeSurveys","trigger","triggers","actionClass","trackCodeAction","actionClasses","trackNoCodeAction","personStateSyncIntervalId","DEFAULT_PERSON_STATE_NO_USER_ID","fetchPersonState","noCache","fetchOptions","cache","jsonRes","responseMessage","state","defaultPersonState","clearPersonStateExpiryCheckListener","clearInterval","setAttributeInApp","isExistingAttribute","logger$5","result","changed","ignore","updateAttribute","wrapThrowsAsync","environmentStateSyncIntervalId","fetchEnvironmentState","clearEnvironmentStateExpiryCheckListener","appConfig","events","arePageUrlEventListenersAdded","checkPageUrl","noCodePageViewActionClasses","noCodeConfig","event","trackResult","checkPageUrlWrapper","removePageUrlEventListeners","removeEventListener","isClickEventListenerAdded","checkClickMatch","noCodeClickActionClasses","targetElement","innerHtml","elementSelector","cssSelector","innerHTML","individualSelectors","selector","matches","evaluateNoCodeConfigClick","then","onSuccess","onError","_value","checkClickMatchWrapper","removeClickEventListener","isExitIntentListenerAdded","checkExitIntentWrapper","noCodeExitIntentActionClasses","clientY","checkExitIntent","removeExitIntentListener","scrollDepthListenerAdded","scrollDepthTriggered","checkScrollDepthWrapper","scrollPosition","scrollY","windowSize","innerHeight","bodyHeight","documentElement","scrollHeight","noCodefiftyPercentScrollActionClasses","checkScrollDepth","removeScrollDepthListener","areRemoveEventListenersAdded","addEventListeners","setInterval","existingConfig","addEventListener","querySelector","readyState","removeAllEventListeners","isInitialized","setIsInitialized","initialize","configInput","isDebug","newState","oldWebsiteConfig","oldAppConfig","parsedOldConfig","migrateLocalStorage","logger$2","field","updatedAttributes","existingAttributes","entries","updateAttributes","isEnvironmentStateExpired","isPersonStateExpired","surveyNames","putFormbricksInErrorState","handleErrorOnFirstInit","initialErrorConfig","deinitalize","logoutPerson","resetPerson","syncParams","checkInitialized","command","commandArgs","running","commandPromise","resolvePromise","run","wait","currentItem","initResult","executeCommand","setAttribute","initConfig","setEmail","email","track","logout","reset","registerRouteChange","getApi"],"mappings":"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"}